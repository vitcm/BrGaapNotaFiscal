/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
(function(){"use strict";function e(){sap.ui.define("sap/ui/core/plugin/LessSupport",["sap/ui/thirdparty/jquery","sap/ui/core/ThemeCheck","sap/base/Log","sap/base/util/UriParameters","sap/ui/core/Core"],function(jQuery,e,t,i){var s="library.source";var r="library";var o=function(){};o.prototype.startPlugin=function(s,r){t.info("Starting LessSupport plugin.");t.warning("  NOT FOR PRODUCTIVE USAGE! LessSupport is an experimental feature which might change in future!");var o=i.fromQuery(window.location.search);var n=o.get("sap-ui-xx-noless");if(n){n=n.toLowerCase()}try{if(n!=="false"&&(window.top.JsUnit||window.sap.ui.test&&window.sap.ui.test.qunit)){t.info("  LessSupport has been deactivated for JSUnit Testrunner or QUnit.");return}}catch(e){}if(n&&n!=="false"){t.info("  LessSupport has been deactivated by URL parameter.");return}else{t.info('  LessSupport can be deactivated by adding the following parameter to your URL: "sap-ui-xx-noless=X".')}window.less=window.less||{env:"development",relativeUrls:true,errorReporting:function(e,t,i){if(e==="add"&&window.console){window.console.error("Failed to parse: "+i,t)}}};sap.ui.requireSync("sap/ui/thirdparty/less");this.oCore=s;this.bActive=true;this.oCore.includeLibraryTheme=jQuery.proxy(this.includeLibraryTheme,this);this.oCore.applyTheme=jQuery.proxy(this.applyTheme,this);var a=this,d=false;var u=[];jQuery("link[id^=sap-ui-theme-]").each(function(){var e=a.initLink(this);d=e||d;if(e){u.push(this.id.substr(13))}});this.refreshLess(d);var p=0;function h(){var i=true;var r;for(var o=0;o<u.length;o++){r=e.checkStyle("less:"+u[o],true);if(r){jQuery(document.getElementById("sap-ui-theme-"+u[o])).attr("data-sap-ui-ready","true")}i=i&&r}p++;if(p>100){i=true;t.warning("LessSupport: Max theme check cycles reached.")}if(i){e.themeLoaded=true;setTimeout(function(){s.fireThemeChanged({theme:s.sTheme})},0)}else{a.iCheckThemeAppliedTimeout=setTimeout(h,100)}}if(d){this.iCheckThemeAppliedTimeout=setTimeout(h,100)}};o.prototype.stopPlugin=function(){t.info("Stopping LessSupport plugin.");if(this.bActive){clearTimeout(this.iCheckThemeAppliedTimeout);delete this.iCheckThemeAppliedTimeout;jQuery("link[id^=sap-ui-theme-]").each(function(){var e=this.id.substr(13);jQuery(document.getElementById("less:"+e)).remove()});delete this.oCore.includeLibraryTheme;delete this.oCore.applyTheme;this.oCore=null}};o.prototype.initLink=function(e){var t=this.updateLink(e);jQuery("<style>").attr("id","less:"+e.id.substr(13)).attr("type","text/css").attr("media",this.media||"screen").insertAfter(e);return t};o.prototype.updateLink=function(e){var i=e.id.substr(13);var o;if((o=i.indexOf("-["))>0){i=i.substr(0,o)}var n=this.oCore._getThemePath(i,this.oCore.sTheme);var a=this.getLastModified(n+s+".less");var d=this.getLastModified(n+r+".css");var u=a==0&&d>0||a>d;if(!u){var p=this.oCore._getThemePath(i,"base");var h=this.getLastModified(p+s+".less");var l=this.getLastModified(p+r+".css");u=h==0&&l>0||h>l}var c=u?s:r;t.debug("LessSupport.updateLink: "+n+c+": "+(u?"LESS":"CSS"));if(!u){if(e.title){delete e.title}e.rel="stylesheet";e.href=n+c+".css";this.unregisterLink(e);return false}e.title=i;e.rel="stylesheet/less";e.href=n+c+".less";this.registerLink(e);return true};o.prototype.getLastModified=function(e){var i;jQuery.ajax({url:e,type:"HEAD",async:false,success:function(e,t,s){var r=s.getResponseHeader("Last-Modified");i=r?Date.parse(r):0},error:function(e,t,s){i=-1}});t.debug("CSS/LESS head-check: "+e+"; last-modified: "+i);return i};o.prototype.applyTheme=function(e,t){sap.ui.core.Core.prototype.applyTheme.apply(this.oCore,arguments);var i=this,s=false;jQuery("link[id^=sap-ui-theme-]").each(function(){s=i.updateLink(this)||s});this.refreshLess(s)};o.prototype.includeLibraryTheme=function(e){sap.ui.core.Core.prototype.includeLibraryTheme.apply(this.oCore,arguments);var t=this,i=false;jQuery("link[id='sap-ui-theme-"+e+"']").each(function(){i=t.initLink(this)||i});this.refreshLess(i)};o.prototype.registerLink=function(e){if(window.less&&window.less.sheets){var t=window.less.sheets.indexOf(e);if(t===-1){window.less.sheets.push(e)}}};o.prototype.unregisterLink=function(e){if(window.less&&window.less.sheets){var t=e.id.substr(13);var i=window.less.sheets.indexOf(e);if(i>=0){window.less.sheets.splice(i,1);jQuery(document.getElementById("less:"+t)).html("")}}};o.prototype.refreshLess=function(e){if(e){if(!document.getElementById("sap-ui-ide-less-mode")){jQuery("<span>").attr("id","sap-ui-ide-less-mode").css("position","absolute").css("right","10px").css("bottom","10px").css("padding","10px").css("border","3px solid red").css("border-radius","10px").css("opacity","0.75").css("color","black").css("background-color","white").css("font-weight","bold").css("z-index","99999").append(jQuery("<span>").text("LESS MODE").css({display:"block","text-align":"center"})).append(jQuery("<a>").attr("href","#").text("Deactivate").attr("title","Less mode is active. Click to deactivate it (requires page refresh).").css({float:"left",clear:"left","font-size":"0.75em","text-decoration":"underline","margin-right":"0.5em"}).bind("click",function(e){e.preventDefault();if(window.confirm("Deactivating the Less Mode refreshes the page. Do you want to proceed?")){var t=window.location.search;window.location.search=(t.charAt(0)==="?"?t+"&":"?")+"sap-ui-xx-noless=true"}})).append(jQuery("<a>").attr("href","#").text("Hide").attr("title","Less mode is active. Click to hide this information.").css({float:"right","font-size":"0.75em","text-decoration":"underline"}).bind("click",function(e){e.preventDefault();jQuery(this).parent().css("display","none")})).appendTo(window.document.body)}}else{jQuery("#sap-ui-ide-less-mode").remove()}if(window.less&&window.less.refresh&&window.less.sheets.length>0){var i={};var s={};jQuery(window.less.sheets).each(function(){s[this.href]=jQuery(this).attr("id").substr(13)});var r=window.less.tree.Rule.prototype.eval;window.less.tree.Rule.prototype.eval=function(e){if(this.variable&&typeof this.name==="string"&&this.name.indexOf("@_PRIVATE_")!==0){var o=s[this.currentFileInfo.rootFilename];if(!o){t.warning("LessSupport: could not find libary ("+this.currentFileInfo.rootFilename+")")}var n=i[o];if(!n){n=i[o]={}}try{n[this.name.substr(1)]=this.value.eval(e).toCSS(e)}catch(e){}}return r.apply(this,arguments)};window.less.refresh();var o=sap.ui.requireSync("sap/ui/core/theming/Parameters");o._setOrLoadParameters(i);window.less.tree.Rule.prototype.eval=r}};var n=new o;sap.ui.getCore().registerPlugin(n);o.refresh=function(){n.refreshLess(true);if(n.oCore.oThemeCheck){n.oCore.oThemeCheck.fireThemeChangedEvent(false)}};return o},true)}if(!(window.sap&&window.sap.ui&&window.sap.ui.define)){var t=function(){document.removeEventListener("DOMContentLoaded",t,false);e()};document.addEventListener("DOMContentLoaded",t,false)}else{e()}})();
//# sourceMappingURL=LessSupport.js.map