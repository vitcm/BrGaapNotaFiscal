/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.getCore().loadLibrary("sap.ui.unified");sap.ui.define(["sap/ui/thirdparty/jquery","./InputBase","./DatePicker","sap/ui/model/type/Date","sap/ui/unified/DateRange","./library","sap/ui/core/Control","sap/ui/Device","sap/ui/core/format/DateFormat","sap/ui/core/LocaleData","./DateTimePickerRenderer","./TimePickerSliders","./SegmentedButton","./SegmentedButtonItem","./ResponsivePopover","./Button","sap/ui/events/KeyCodes","sap/ui/core/IconPool"],function(jQuery,e,t,i,s,o,a,n,r,p,l,u,g,d,h,c,f,_){"use strict";var y=o.PlacementType,m=o.ButtonType,S="Phone";var C=t.extend("sap.m.DateTimePicker",{metadata:{library:"sap.m",properties:{minutesStep:{type:"int",group:"Misc",defaultValue:1},secondsStep:{type:"int",group:"Misc",defaultValue:1}},designtime:"sap/m/designtime/DateTimePicker.designtime",dnd:{draggable:false,droppable:true}}});var D={Short:"short",Medium:"medium",Long:"long",Full:"full"};var P=a.extend("sap.m.internal.DateTimePickerPopup",{metadata:{library:"sap.m",aggregations:{_switcher:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},calendar:{type:"sap.ui.core.Control",multiple:false},timeSliders:{type:"sap.ui.core.Control",multiple:false}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapMDateTimePopupCont").class("sapMTimePickerDropDown");e.openEnd();var i=t.getAggregation("_switcher");if(i){e.openStart("div");e.class("sapMTimePickerSwitch");e.openEnd();e.renderControl(i);e.close("div")}var s=t.getCalendar();if(s){e.renderControl(s)}e.openStart("div");e.class("sapMTimePickerSep");e.openEnd();e.close("div");var o=t.getTimeSliders();if(o){e.renderControl(o)}e.close("div")}},init:function(){},onBeforeRendering:function(){var e=this.getAggregation("_switcher");if(!e){var t=sap.ui.getCore().getLibraryResourceBundle("sap.m");var i=t.getText("DATETIMEPICKER_DATE");var s=t.getText("DATETIMEPICKER_TIME");e=new g(this.getId()+"-Switch",{selectedKey:"Cal",items:[new d(this.getId()+"-Switch-Cal",{key:"Cal",text:i}),new d(this.getId()+"-Switch-Sli",{key:"Sli",text:s})]});e.attachSelect(this._handleSelect,this);this.setAggregation("_switcher",e,true)}if(n.system.phone||jQuery("html").hasClass("sapUiMedia-Std-Phone")){e.setVisible(true);e.setSelectedKey("Cal")}else{e.setVisible(false)}},onAfterRendering:function(){this.getAggregation("timeSliders").getAggregation("_columns")[0].setIsExpanded(false);if(n.system.phone||jQuery("html").hasClass("sapUiMedia-Std-Phone")){var e=this.getAggregation("_switcher");var t=e.getSelectedKey();this._switchVisibility(t)}},_handleSelect:function(e){this._switchVisibility(e.getParameter("key"))},_switchVisibility:function(e){var t=this.getCalendar();var i=this.getTimeSliders();if(!t||!i){return}if(e=="Cal"){t.$().css("display","");i.$().css("display","none")}else{t.$().css("display","none");i.$().css("display","");i._updateSlidersValues();i._onOrientationChanged();i.openFirstSlider()}},switchToTime:function(){var e=this.getAggregation("_switcher");if(e&&e.getVisible()){e.setSelectedKey("Sli");this._switchVisibility("Sli")}},getSpecialDates:function(){return this._oDateTimePicker.getSpecialDates()},onkeydown:function(e){var t=e.keyCode===f.TAB&&!e.shiftKey;var i=e.keyCode===f.TAB&&e.shiftKey;if(t&&e.target.classList.contains("sapUiCalHeadBLast")){this.getAggregation("timeSliders").getDomRef().children[0].focus()}if(i&&e.target.classList.contains("sapUiCalItem")){var s=this.oParent.getAggregation("footer").getAggregation("content").length-1;this.oParent.getAggregation("footer").getAggregation("content")[s].focus()}}});C.prototype.init=function(){t.prototype.init.apply(this,arguments);this._bOnlyCalendar=false};C.prototype.getIconSrc=function(){return _.getIconURI("date-time")};C.prototype.exit=function(){t.prototype.exit.apply(this,arguments);if(this._oSliders){this._oSliders.destroy();delete this._oSliders}this._oPopupContent=undefined;n.media.detachHandler(this._handleWindowResize,this)};C.prototype.setDisplayFormat=function(e){t.prototype.setDisplayFormat.apply(this,arguments);if(this._oSliders){this._oSliders.setDisplayFormat(M.call(this))}return this};C.prototype.setMinutesStep=function(e){this.setProperty("minutesStep",e,true);if(this._oSliders){this._oSliders.setMinutesStep(e)}return this};C.prototype._getDefaultValueStyle=function(){return D.Medium};C.prototype.setMinDate=function(e){t.prototype.setMinDate.call(this,e);if(e){this._oMinDate.setHours(e.getHours(),e.getMinutes(),e.getSeconds())}return this};C.prototype.setMaxDate=function(e){t.prototype.setMaxDate.call(this,e);if(e){this._oMaxDate.setHours(e.getHours(),e.getMinutes(),e.getSeconds())}return this};C.prototype.setSecondsStep=function(e){this.setProperty("secondsStep",e,true);if(this._oSliders){this._oSliders.setSecondsStep(e)}return this};C.prototype._getFormatInstance=function(e,t){var i=jQuery.extend({},e);var s=-1;if(i.style){s=i.style.indexOf("/")}if(t){var o=jQuery.extend({},i);if(s>0){o.style=o.style.substr(0,s)}this._oDisplayFormatDate=r.getInstance(o)}return r.getDateTimeInstance(i)};C.prototype._checkStyle=function(e){if(t.prototype._checkStyle.apply(this,arguments)){return true}else if(e.indexOf("/")>0){var i=[D.Short,D.Medium,D.Long,D.Long];var s=false;for(var o=0;o<i.length;o++){var a=i[o];for(var n=0;n<i.length;n++){var r=i[n];if(e==a+"/"+r){s=true;break}}if(s){break}}return s}return false};C.prototype._parseValue=function(e,i){var s=t.prototype._parseValue.apply(this,arguments);if(i&&!s){s=this._oDisplayFormatDate.parse(e);if(s){var o=this.getDateValue();if(!o){o=new Date}s.setHours(o.getHours());s.setMinutes(o.getMinutes());s.setSeconds(o.getSeconds());s.setMilliseconds(o.getMilliseconds())}}return s};C.prototype._getLocaleBasedPattern=function(e){var t=p.getInstance(sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale()),i=e.indexOf("/");if(i>0){return t.getCombinedDateTimePattern(e.substr(0,i),e.substr(i+1))}else{return t.getCombinedDateTimePattern(e,e)}};C.prototype._createPopup=function(){var e,t,i,s,o,a;if(!this._oPopup){i=sap.ui.getCore().getLibraryResourceBundle("sap.m");s=i.getText("TIMEPICKER_SET");o=i.getText("TIMEPICKER_CANCEL");this._oPopupContent=new P(this.getId()+"-PC");this._oPopupContent._oDateTimePicker=this;this._oOKButton=new c(this.getId()+"-OK",{text:s,type:m.Emphasized,press:T.bind(this)});this._oPopup=new h(this.getId()+"-RP",{showCloseButton:false,showHeader:false,placement:y.VerticalPreferedBottom,beginButton:this._oOKButton,content:this._oPopupContent,afterOpen:w.bind(this),afterClose:b.bind(this)});if(n.system.phone){e=this.$("inner").attr("aria-labelledby");t=e?document.getElementById(e).getAttribute("aria-label"):"";this._oPopup.setTitle(t);this._oPopup.setShowHeader(true);this._oPopup.setShowCloseButton(true)}else{this._oPopup._getPopup().setDurations(0,0);this._oPopup.setEndButton(new c(this.getId()+"-Cancel",{text:o,press:v.bind(this)}))}this._oPopup.addStyleClass("sapMDateTimePopup");a=this._oPopup.getAggregation("_popup");if(a.setShowArrow){a.setShowArrow(false)}this.setAggregation("_popup",this._oPopup,true)}};C.prototype._openPopup=function(){if(!this._oPopup){return}this.addStyleClass(e.ICON_PRESSED_CSS_CLASS);var t=this._oPopup.getAggregation("_popup");t.oPopup.setAutoCloseAreas([this.getDomRef()]);this._oPopup.openBy(this);var i=this._oPopup.getContent()[0]&&this._oPopup.getContent()[0].getTimeSliders();if(i){setTimeout(i._updateSlidersValues.bind(i),0)}};C.prototype._createPopupContent=function(){var e=!this._oCalendar;t.prototype._createPopupContent.apply(this,arguments);if(e){this._oPopupContent.setCalendar(this._oCalendar);this._oCalendar.attachSelect(A,this)}if(!this._oSliders){this._oSliders=new u(this.getId()+"-Sliders",{minutesStep:this.getMinutesStep(),secondsStep:this.getSecondsStep(),displayFormat:M.call(this),localeId:this.getLocaleId()})._setShouldOpenSliderAfterRendering(true);this._oPopupContent.setTimeSliders(this._oSliders)}};C.prototype._selectFocusedDateValue=function(e){var t=this._oCalendar;t.removeAllSelectedDates();t.addSelectedDate(e);return this};C.prototype._fillDateRange=function(){var e=this.getDateValue(),t=true;if(e){e=new Date(e.getTime());this._oOKButton.setEnabled(true)}else{t=false;e=this.getInitialFocusedDateValue();if(!e){e=new Date;this._oCalendar.removeAllSelectedDates()}var i=this._oMaxDate.getTime();if(e.getTime()<this._oMinDate.getTime()||e.getTime()>i){e=this._oMinDate}this._oOKButton.setEnabled(false)}this._oCalendar.focusDate(e);if(t){if(!this._oDateRange.getStartDate()||this._oDateRange.getStartDate().getTime()!=e.getTime()){this._oDateRange.setStartDate(e)}}this._oSliders._setTimeValues(e)};C.prototype._getSelectedDate=function(){var e=t.prototype._getSelectedDate.apply(this,arguments);if(e){var i=this._oSliders.getTimeValues();var s=this._oSliders._getDisplayFormatPattern();if(s.search("h")>=0||s.search("H")>=0){e.setHours(i.getHours())}if(s.search("m")>=0){e.setMinutes(i.getMinutes())}if(s.search("s")>=0){e.setSeconds(i.getSeconds())}if(e.getTime()<this._oMinDate.getTime()){e=new Date(this._oMinDate.getTime())}else if(e.getTime()>this._oMaxDate.getTime()){e=new Date(this._oMaxDate.getTime())}}return e};C.prototype.getLocaleId=function(){return sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()};C.prototype.getAccessibilityInfo=function(){var e=t.prototype.getAccessibilityInfo.apply(this,arguments);e.type=sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_DATETIMEINPUT");return e};function T(e){this._handleCalendarSelect()}function v(e){this.onsaphide(e);if(!this.getDateValue()){this._oCalendar.removeAllSelectedDates()}}C.prototype._handleWindowResize=function(e){var t=this.getAggregation("_popup").getContent()[0].getAggregation("_switcher"),i=this.getAggregation("_popup").getContent()[0].getCalendar(),s=this.getAggregation("_popup").getContent()[0].getTimeSliders();if(e.name===S){t.setVisible(true);this.getAggregation("_popup").getContent()[0]._switchVisibility(t.getSelectedKey())}else{t.setVisible(false);s.$().css("display","");i.$().css("display","")}};function w(e){this.$("inner").attr("aria-expanded",true);this._oCalendar.focus();this._oSliders._onOrientationChanged();n.media.attachHandler(this._handleWindowResize,this)}function b(){this.removeStyleClass(e.ICON_PRESSED_CSS_CLASS);this.$("inner").attr("aria-expanded",false);this._oCalendar._closePickers();n.media.detachHandler(this._handleWindowResize,this)}function M(){var e=this.getDisplayFormat();var t;var s=this.getBinding("value");if(s&&s.oType&&s.oType instanceof i){e=s.oType.getOutputPattern()}else if(s&&s.oType&&s.oType.oFormat){e=s.oType.oFormat.oFormatOptions.pattern}else{e=this.getDisplayFormat()}if(!e){e=D.Medium}var o=e.indexOf("/");if(o>0&&this._checkStyle(e)){e=e.substr(o+1)}if(e==D.Short||e==D.Medium||e==D.Long||e==D.Full){var a=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var n=p.getInstance(a);t=n.getTimePattern(e)}else{t=e}return t}function A(e){this._oOKButton.setEnabled(true);this._oPopupContent.switchToTime()}return C});
//# sourceMappingURL=DateTimePicker.js.map