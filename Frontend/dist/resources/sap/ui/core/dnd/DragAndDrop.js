/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","../UIArea","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(t,e,jQuery){"use strict";var r={},n=null,i=null,o=null,a=[],f=[],g=null,u,s,l,d,c={},p;function h(t,e){if(!t){return}if(t.addStyleClass){t.addStyleClass(e)}else{t.$().addClass(e)}}function D(t,e){if(!t){return}if(t.removeStyleClass){t.removeStyleClass(e)}else{t.$().removeClass(e)}}function v(t,e){var r=jQuery(t.target).control(0,true);if(!r){return}var n=jQuery.Event(null,t);n.type=e;r.getUIArea()._handleEvent(n)}function m(t){return!t.disabled&&/^(input|textarea)$/.test(t.localName)}function w(t,e){if(!t||!t.getDragGhost){return}var r=t.getDragGhost();if(!r){return}if(!s){s=jQuery('<div class="sapUiDnDGhostContainer"></div>');jQuery(document.body).append(s)}s.append(r);window.setTimeout(function(){s.empty()},0);var n=e.originalEvent;n.dataTransfer.setDragImage(r,n.offsetX,n.offsetY)}function C(t){var e={},r,i=t.originalEvent.dataTransfer,a=function(t,e){i.setData(t,e)};return{setData:function(t,r){r=""+r;e[t]=r;a(t,r)},getData:function(t){return e[t]},setTextData:function(t){t=""+t;e["text/plain"]=t;e["text"]=t;a("text/plain",t);a("text",t)},getTextData:function(){return e["text/plain"]},setComplexData:function(t,r){e[t]=r},getComplexData:function(t){return e[t]},getIndicator:function(){return u&&u[0]},setIndicatorConfig:function(t){r=t},getIndicatorConfig:function(t){return r},getDragControl:function(){return n},getDropControl:function(){return o},setDropControl:function(t){o=t},getDropInfo:function(){return f[0]||null},getDropPosition:function(){return l}}}function b(t){n=i=o=g=null;l="";a=[];f=[]}function E(){if(u){return u}u=jQuery("<div class='sapUiDnDIndicator'></div>");jQuery(sap.ui.getCore().getStaticAreaRef()).append(u);return u}function y(){if(u){u.removeAttr("style");u.hide();c={}}}function S(t,e,r,n){if(!e){return}var i=t.dragSession&&t.dragSession.getIndicatorConfig(),o=e.getBoundingClientRect(),a=window.pageYOffset,f=window.pageXOffset,g=E(),u,s={},l={top:o.top+a,bottom:o.bottom+a,left:o.left+f,right:o.right+f,width:o.width,height:o.height};if(!r||r=="On"){u="On";n=""}else if(n=="Horizontal"){var d=t.pageX-l.left;s.height=l.height;s.top=l.top;if(r=="Between"){s.width="";if(d<l.width*.5){u="Before";s.left=l.left}else{u="After";s.left=l.right}}else if(r=="OnOrBetween"){if(d<l.width*.25){u="Before";s.left=l.left;s.width=""}else if(d>l.width*.75){u="After";s.left=l.right;s.width=""}else{u="On"}}if(u!="On"&&sap.ui.getCore().getConfiguration().getRTL()){u=u=="After"?"Before":"After"}}else{var p=t.pageY-l.top;s.width=l.width;s.left=l.left;if(r=="Between"){s.height="";if(p<l.height*.5){u="Before";s.top=l.top}else{u="After";s.top=l.bottom}}else if(r=="OnOrBetween"){if(p<l.height*.25){u="Before";s.top=l.top;s.height=""}else if(p>l.height*.75){u="After";s.top=l.bottom;s.height=""}else{u="On"}}}if(i&&i.display=="none"){return u}if(u=="On"){s.top=l.top;s.left=l.left;s.width=l.width;s.height=l.height;r=u}else{r="Between"}if(c.top!=s.top||c.left!=s.left||c.width!=s.width||c.height!=s.height){g.attr("data-drop-layout",n);g.attr("data-drop-position",r);g.css(Object.assign(s,i));g.show();c=s}return u}function O(t){var e=t.getParent(),r=t.getDragDropConfig?t.getDragDropConfig():[],n=e&&e.getDragDropConfig?e.getDragDropConfig():[];return r.concat(n)}function A(t){var e=O(t);return e.filter(function(e){return e.isDraggable(t)})}function x(t,e,r){var n=O(t);e=e||[];return n.filter(function(t){return!t.isA("sap.ui.core.dnd.IDragInfo")}).concat(e).filter(function(n){if(!n.isDroppable(t,r)){return false}var i=n.getGroupName();if(!i){return true}return e.some(function(t){return t.getGroupName()==i})})}function T(t,e){t.preventDefault();var r=e.getDropEffect().toLowerCase();t.originalEvent.dataTransfer.dropEffect=r}function I(t,e,r){var n=e.getTargetAggregation();if(!n){return S(t,r.getDomRef())}var i;if(t.getMark("DragWithin")==n){i=r.getDomRefForSetting(n)}i=i||r.getDomRef();return S(t,i,e.getDropPosition(true),e.getDropLayout(true))}r.preprocessEvent=function(t){if(g&&t.type.indexOf("dr")==0){t.dragSession=g}var e="onbefore"+t.type;if(r[e]){r[e](t)}};r.postprocessEvent=function(t){var e="onafter"+t.type;if(r[e]){r[e](t)}};r.onbeforemousedown=function(e){if(t.browser.firefox&&m(e.target)){p=jQuery(e.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0]}};r.onbeforemouseup=function(t){if(p){p.draggable=true;p=null}};r.onbeforedragstart=function(e){if(!e.target.draggable){return}if(m(document.activeElement)){e.target.getAttribute("data-sap-ui-draggable")&&e.preventDefault();return}n=jQuery(e.target).control(0,true);if(!n){return}a=A(n);if(!a.length){return}if(t.browser.firefox&&e.originalEvent.dataTransfer.types.length===0){e.originalEvent.dataTransfer.setData("ui5/dummyDataForFirefox","data")}e.dragSession=g=C(e)};r.onafterdragstart=function(t){if(!a.length||t.isDefaultPrevented()){b();return}a=t.isMarked("NonDraggable")?[]:a.filter(function(e){return e.fireDragStart(t)});if(!a.length){t.preventDefault();b();return}w(n,t);h(n,"sapUiDnDDragging");if(jQuery(t.target).closest(".sapUiScrollDelegate")[0]){jQuery("html").addClass("sapUiDnDNoScrolling")}};r.onbeforedragenter=function(t){var e=jQuery(t.target).control(0,true);if(e&&i===e){t.setMark("DragWithin","SameControl")}else{d=Date.now();i=e}var r=[];o=e;for(var n=0;n<20&&o;n++,o=o.getParent()){r=x(o,a,t);if(r.length){break}}if(t.getMark("DragWithin")!="SameControl"){f=r;if(g){g.setIndicatorConfig(null)}}if(!f.length){o=null}else if(!g){t.dragSession=g=C(t)}};r.onafterdragenter=function(t){if(!o||t.isMarked("NonDroppable")){f=[]}else if(t.getMark("DragWithin")!="SameControl"){f=f.filter(function(e){return e.fireDragEnter(t)})}var e=f[0];if(!e||e.getDropEffect()=="None"){y();l=""}else{T(t,e);l=I(t,e,o)}};r.onbeforedragover=function(t){var e=Date.now();if(e-d>=1e3){v(t,"longdragover");d=e}};r.onafterdragover=function(t){var e=f[0];if(!e||e.getDropEffect()=="None"){return}f.forEach(function(e){e.fireDragOver(t)});T(t,e);if(e&&e.getDropPosition(true)=="On"){return}l=I(t,e,o)};r.onbeforedrop=function(t){if(f.length){t.preventDefault()}};r.onafterdrop=function(t){f.forEach(function(e){e.fireDrop(t)});this.iDragEndTimer=window.requestAnimationFrame(this.onafterdragend.bind(this,t))};r.onafterdragend=function(t){this.iDragEndTimer=window.cancelAnimationFrame(this.iDragEndTimer);a.forEach(function(e){e.fireDragEnd(t)});D(n,"sapUiDnDDragging");jQuery("html").removeClass("sapUiDnDNoScrolling");y();b()};e.addEventPreprocessor(r.preprocessEvent);e.addEventPostprocessor(r.postprocessEvent);return r},true);
//# sourceMappingURL=DragAndDrop.js.map