/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/Popover","sap/ui/Device","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Locale","sap/ui/core/LocaleData","sap/ui/core/Renderer","sap/ui/core/format/DateFormat","./calendar/CalendarUtils","./calendar/CustomYearPicker","./calendar/Header","./calendar/MonthsRow","./calendar/YearPicker","./calendar/CalendarDate","./CalendarMonthIntervalRenderer","sap/ui/dom/containsOrEquals","sap/base/util/deepEqual","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/unified/DateRange"],function(t,e,a,i,o,s,r,n,h,g,c,l,u,f,d,D,p,_,jQuery,v){"use strict";var m=a.extend("sap.ui.unified.CalendarMonthInterval",{metadata:{library:"sap.ui.unified",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},startDate:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},months:{type:"int",group:"Appearance",defaultValue:12},pickerPopup:{type:"boolean",group:"Appearance",defaultValue:false},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},_currentPicker:{type:"string",group:"Appearance",defaultValue:"monthsRow",visibility:"hidden"}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},header:{type:"sap.ui.unified.calendar.Header",multiple:false,visibility:"hidden"},monthsRow:{type:"sap.ui.unified.calendar.MonthsRow",multiple:false,visibility:"hidden"},yearPicker:{type:"sap.ui.unified.calendar.YearPicker",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},cancel:{},startDateChange:{}}}});var M={MONTHS_ROW:"monthsRow",YEAR_PICKER:"yearPicker"};m.prototype.init=function(){this._iMode=0;this.data("sap-ui-fastnavgroup","true",true);this._oYearFormat=n.getDateInstance({format:"y"});this._oMinDate=h._minDate();this._oMaxDate=h._maxDate();this._initializeHeader();this._initializeMonthsRow();this._initilizeYearPicker();this._iDaysMonthsHead=15};m.prototype.exit=function(){if(this._sInvalidateContent){clearTimeout(this._sInvalidateContent)}if(this._oPopup){this._oPopup.destroy();this._oPopup=null}if(this._oCustomYearPicker){this._oCustomYearPicker.removeDelegate(this._oFocusCYPDelegate);this._oCustomYearPicker.destroy();this._oCustomYearPicker=null}};m.prototype.onBeforeRendering=function(){var t=this.getAggregation("monthsRow");var e=this._getFocusedDate();w.call(this);t.displayDate(e.toLocalJSDate())};m.prototype._setAriaRole=function(t){var e=this.getAggregation("monthsRow");e._setAriaRole(t);e.invalidate();return this};m.prototype._initializeHeader=function(){var t=new c(this.getId()+"--Head",{visibleButton0:false,visibleButton1:false,visibleButton2:true});t.attachEvent("pressPrevious",this._handlePrevious,this);t.attachEvent("pressNext",this._handleNext,this);t.attachEvent("pressButton2",Y,this);this.setAggregation("header",t)};m.prototype._initializeMonthsRow=function(){var t=new l(this.getId()+"--MonthsRow");t.attachEvent("focus",B,this);t.attachEvent("select",N,this);t._bNoThemeChange=true;this.setAggregation("monthsRow",t)};m.prototype._initilizeYearPicker=function(){var t=this._createYearPicker();this.setAggregation("yearPicker",t);t._setSelectedDatesControlOrigin(this)};m.prototype._createYearPicker=function(){var t=new u(this.getId()+"--YP",{columns:0,years:6});t.attachEvent("select",O,this);t.attachEvent("pageChange",T,this);t._oMinDate.setYear(this._oMinDate.getYear());t._oMaxDate.setYear(this._oMaxDate.getYear());return t};m.prototype._getCalendarPicker=function(){var t;if(!this._oCustomYearPicker){t=new g(this.getId()+"--Cal");t.setPopupMode(true);t.attachEvent("select",J,this);t.attachEvent("cancel",function(t){this._oPopup.close();var e=this.getAggregation("header").getDomRef("B2");if(e){e.focus()}},this);this._oFocusCYPDelegate={onAfterRendering:function(){this.focus()}};t.addDelegate(this._oFocusCYPDelegate,t);this._oCustomYearPicker=t}return this._oCustomYearPicker};m.prototype.setStartDate=function(t){h._checkJSDateObject(t);if(p(this.getStartDate(),t)){return this}var e=t.getFullYear();h._checkYearInValidRange(e);this.setProperty("startDate",t,true);this._oStartDate=f.fromLocalJSDate(t);this._oStartDate.setDate(1);var a=this.getAggregation("monthsRow");a.setStartDate(t);w.call(this);var i=this._getFocusedDate().toLocalJSDate();if(!a.checkDateFocusable(i)){this._setFocusedDate(this._oStartDate);a.displayDate(t)}return this};m.prototype.invalidate=function(t){if(!this._bDateRangeChanged&&(!t||!(t instanceof v))){a.prototype.invalidate.apply(this,arguments)}else if(this.getDomRef()&&this._iMode==0&&!this._sInvalidateContent){this._sInvalidateContent=setTimeout(E.bind(this),0)}};m.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var t=this.removeAllAggregation("selectedDates");return t};m.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var t=this.destroyAggregation("selectedDates");return t};m.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var t=this.removeAllAggregation("specialDates");return t};m.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var t=this.destroyAggregation("specialDates");return t};m.prototype.setLocale=function(t){if(this._sLocale!=t){this._sLocale=t;this._oLocaleData=undefined;this.invalidate()}return this};m.prototype.getLocale=function(){if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};m.prototype._getFocusedDate=function(){if(!this._oFocusedDate){I.call(this)}return this._oFocusedDate};m.prototype._setFocusedDate=function(t){h._checkCalendarDate(t);this._oFocusedDate=new f(t)};m.prototype.focusDate=function(t){var e=false;var a=this.getAggregation("monthsRow");if(t&&!a.checkDateFocusable(t)){H.call(this,f.fromLocalJSDate(t));e=true}F.call(this,t,false);if(e){this.fireStartDateChange()}return this};m.prototype.displayDate=function(t){F.call(this,t,true);return this};m.prototype.setMonths=function(t){this.setProperty("months",t,true);t=this._getMonths();var e=this.getAggregation("monthsRow");e.setMonths(t);if(!e.checkDateFocusable(this._getFocusedDate().toLocalJSDate())){var a=P.call(this);this._setFocusedDate(this._oStartDate);e.setDate(a.toLocalJSDate())}if(!this.getPickerPopup()){var i=this.getAggregation("yearPicker");var o=Math.floor(t/2);if(o>20){o=20}i.setYears(o)}w.call(this);if(this.getDomRef()){if(this._getShowItemHeader()){this.$().addClass("sapUiCalIntHead")}else{this.$().removeClass("sapUiCalIntHead")}}return this};m.prototype._getMonths=function(){var t=this.getMonths();if(e.system.phone&&t>6){return 6}else{return t}};m.prototype._getLocaleData=function(){if(!this._oLocaleData){var t=this.getLocale();var e=new o(t);this._oLocaleData=s.getInstance(e)}return this._oLocaleData};m.prototype.setPickerPopup=function(t){var e;this.setProperty("pickerPopup",t,true);if(t){if(this.getAggregation("yearPicker")){this.getAggregation("yearPicker").destroy()}}else{if(!this.getAggregation("yearPicker")){this.setAggregation("yearPicker",this._createYearPicker())}e=this.getAggregation("yearPicker");e.setColumns(0);e.setYears(6)}return this};m.prototype.setMinDate=function(t){if(p(t,this.getMinDate())){return this}if(!t){this._oMinDate=h._minDate()}else{h._checkJSDateObject(t);this._oMinDate=f.fromLocalJSDate(t);this._oMinDate.setDate(1);var e=this._oMinDate.getYear();h._checkYearInValidRange(e);if(this._oMaxDate.isBefore(this._oMinDate)){_.warning("minDate > maxDate -> maxDate set to end of the month",this);this._oMaxDate=f.fromLocalJSDate(t);this._oMaxDate.setDate(h._daysInMonth(this._oMaxDate));this.setProperty("maxDate",this._oMaxDate.toLocalJSDate(),true)}if(this._oFocusedDate){if(this._oFocusedDate.isBefore(this._oMinDate)){_.warning("focused date < minDate -> minDate focused",this);this.focusDate(t)}}if(this._oStartDate&&this._oStartDate.isBefore(this._oMinDate)){_.warning("start date < minDate -> minDate set as start date",this);y.call(this,new f(this._oMinDate),true,true)}}this.setProperty("minDate",t,false);if(this.getPickerPopup()){var a=this._getCalendarPicker();a.setMinDate(t)}else{var i=this.getAggregation("yearPicker");i._oMinDate.setYear(this._oMinDate.getYear())}return this};m.prototype.setMaxDate=function(t){if(p(t,this.getMaxDate())){return this}if(!t){this._oMaxDate=h._maxDate()}else{h._checkJSDateObject(t);this._oMaxDate=f.fromLocalJSDate(t);this._oMaxDate.setDate(h._daysInMonth(this._oMaxDate));var e=this._oMaxDate.getYear();h._checkYearInValidRange(e);if(this._oMinDate.isAfter(this._oMaxDate)){_.warning("maxDate < minDate -> minDate set to begin of the month",this);this._oMinDate=f.fromLocalJSDate(t);this._oMinDate.setDate(1);this.setProperty("minDate",this._oMinDate.toLocalJSDate(),true)}if(this._oFocusedDate){if(this._oFocusedDate.isAfter(this._oMaxDate)){_.warning("focused date > maxDate -> maxDate focused",this);this.focusDate(t)}}if(this._oStartDate){var a=new f(this._oStartDate);a.setDate(1);a.setMonth(a.getMonth()+this._getMonths());a.setDate(0);if(a.isAfter(this._oMaxDate)){var i=new f(this._oMaxDate);i.setDate(1);i.setMonth(i.getMonth()-this._getMonths()+1);if(i.isSameOrAfter(this._oMinDate)){_.warning("end date > maxDate -> maxDate set as end date",this);y.call(this,i,true,true)}}}}this.setProperty("maxDate",t,false);if(this.getPickerPopup()){var o=this._getCalendarPicker();o.setMaxDate(t)}else{var s=this.getAggregation("yearPicker");s._oMaxDate.setYear(this._oMaxDate.getYear())}return this};m.prototype.onclick=function(t){if(t.isMarked("delayedMouseEvent")){return}if(t.target.id==this.getId()+"-cancel"){this.onsapescape(t)}};m.prototype.onmousedown=function(t){t.preventDefault();t.setMark("cancelAutoClose")};m.prototype.onsapescape=function(t){if(this.getPickerPopup()){L.call(this);this.fireCancel()}else{switch(this._iMode){case 0:this.fireCancel();break;case 1:R.call(this);break}}};m.prototype.onsaptabnext=function(t){var e=this.getAggregation("header"),a,i;if(D(this.getDomRef("content"),t.target)){if(e.getDomRef("B2")){e.getDomRef("B2").focus()}if(!this._bPoupupMode){i=this.getAggregation("monthsRow");jQuery(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1");if(!this.getPickerPopup()){a=this.getAggregation("yearPicker");if(a.getDomRef()){jQuery(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}t.preventDefault()}};m.prototype.onsaptabprevious=function(t){var e=this.getAggregation("header"),a,i;if(D(this.getDomRef("content"),t.target)){if(this._bPoupupMode){if(e.getDomRef("B2")){e.getDomRef("B2").focus()}t.preventDefault()}}else if(t.target.id==e.getId()+"-B2"){switch(this._iMode){case 0:a=this.getAggregation("monthsRow");a._oItemNavigation.focusItem(a._oItemNavigation.getFocusedIndex());break;case 1:if(!this.getPickerPopup()){i=this.getAggregation("yearPicker");i._oItemNavigation.focusItem(i._oItemNavigation.getFocusedIndex())}break}t.preventDefault()}};m.prototype.onfocusin=function(t){if(t.target.id==this.getId()+"-end"){var e=this.getAggregation("header"),a,i;if(e.getDomRef("B2")){e.getDomRef("B2").focus()}if(!this._bPoupupMode){a=this.getAggregation("monthsRow");jQuery(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1");if(!this.getPickerPopup()){i=this.getAggregation("yearPicker");if(i.getDomRef()){jQuery(i._oItemNavigation.getItemDomRefs()[i._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}}}}this.$("end").attr("tabindex","-1")};m.prototype.onsapfocusleave=function(t){var e,a;if(!t.relatedControlId||!D(this.getDomRef(),sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef())){this.$("end").attr("tabindex","0");if(!this._bPoupupMode){switch(this._iMode){case 0:e=this.getAggregation("monthsRow");jQuery(e._oItemNavigation.getItemDomRefs()[e._oItemNavigation.getFocusedIndex()]).attr("tabindex","0");break;case 1:if(!this.getPickerPopup()){a=this.getAggregation("yearPicker");jQuery(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}break}}}};m.prototype._handlePrevious=function(t){var e,a,i,o;switch(this._iMode){case 0:e=this._getFocusedDate();a=this._getMonths();i=new f(P.call(this));i.setMonth(i.getMonth()-a);e.setMonth(e.getMonth()-a);this._setFocusedDate(e);y.call(this,i,true);break;case 1:if(!this.getPickerPopup()){o=this.getAggregation("yearPicker");o.previousPage();S.call(this)}break}};m.prototype._handleNext=function(t){var e,a,i,o;switch(this._iMode){case 0:e=this._getFocusedDate();a=this._getMonths();i=new f(P.call(this));i.setMonth(i.getMonth()+a);e.setMonth(e.getMonth()+a);this._setFocusedDate(e);y.call(this,i,true);break;case 1:if(!this.getPickerPopup()){o=this.getAggregation("yearPicker");o.nextPage();S.call(this)}break}};m.prototype._showOverlay=function(){this.$("contentOver").css("display","")};m.prototype._hideOverlay=function(){this.$("contentOver").css("display","none")};m.prototype._getShowItemHeader=function(){var t=this.getMonths();if(t>this._iDaysMonthsHead){return true}else{return false}};function y(t,e,a){var i=new f(this._oMaxDate);i.setDate(1);i.setMonth(i.getMonth()-this._getMonths()+1);if(i.isBefore(this._oMinDate)){i=new f(this._oMinDate);i.setMonth(i.getMonth()+this._getMonths()-1)}if(t.isBefore(this._oMinDate)){t=new f(this._oMinDate)}else if(t.isAfter(i)){t=i}t.setDate(1);var o=t.toLocalJSDate();this.setProperty("startDate",o,true);this._oStartDate=t;var s=this.getAggregation("monthsRow");s.setStartDate(o);w.call(this);if(e){var r=this._getFocusedDate().toLocalJSDate();if(!s.checkDateFocusable(r)){this._setFocusedDate(t);s.setDate(o)}else{s.setDate(r)}}if(!a){this.fireStartDateChange()}}function P(){if(!this._oStartDate){this._oStartDate=this._getFocusedDate();this._oStartDate.setDate(1)}return this._oStartDate}function k(t){var e=this._getFocusedDate();var a=this.getAggregation("monthsRow");if(!t){a.setDate(e.toLocalJSDate())}else{a.displayDate(e.toLocalJSDate())}w.call(this)}function I(){var t=this.getSelectedDates();if(t&&t[0]&&t[0].getStartDate()){this._oFocusedDate=f.fromLocalJSDate(t[0].getStartDate())}else{this._oFocusedDate=new f}this._oFocusedDate.setDate(1);if(this._oFocusedDate.isBefore(this._oMinDate)){this._oFocusedDate=new f(this._oMinDate)}else if(this._oFocusedDate.isAfter(this._oMaxDate)){this._oFocusedDate=new f(this._oMaxDate)}}function x(){var t=this._getFocusedDate();var e=this.getAggregation("yearPicker");this.setProperty("_currentPicker",M.YEAR_PICKER);this._showOverlay();e.setDate(t.toLocalJSDate());if(this._iMode==0){var a=this.getAggregation("monthsRow");jQuery(a._oItemNavigation.getItemDomRefs()[a._oItemNavigation.getFocusedIndex()]).attr("tabindex","-1")}S.call(this);this._iMode=1}function R(t){this._iMode=0;this.setProperty("_currentPicker",M.MONTHS_ROW);this._hideOverlay();if(!t){k.call(this);var e=this.getAggregation("monthsRow");jQuery(e._oItemNavigation.getItemDomRefs()[e._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function w(){b.call(this);A.call(this)}function A(){var t=new f(P.call(this));var e=this._getMonths();var a=t.getYear();var i=this._oMaxDate.getYear();var o=this._oMinDate.getYear();var s=t.getMonth();var r=this._oMaxDate.getMonth();var n=this._oMinDate.getMonth();var h=this.getAggregation("header");if(a<o||a==o&&s<=n){h.setEnabledPrevious(false)}else{h.setEnabledPrevious(true)}t.setMonth(t.getMonth()+e-1);a=t.getYear();s=t.getMonth();if(a>i||a==i&&s>=r){h.setEnabledNext(false)}else{h.setEnabledNext(true)}}function S(){var t=this.getAggregation("yearPicker");var e=t.getYears();var a=new f(t.getProperty("_middleDate"));a.setYear(a.getYear()+Math.floor(e/2));var i=this.getAggregation("header");var o=new f(this._oMaxDate);o.setYear(o.getYear()-Math.ceil(e/2));o.setMonth(11,31);var s=new f(this._oMinDate);s.setYear(s.getYear()+Math.floor(e/2)+1);s.setMonth(0,1);i.setEnabledNext(!a.isAfter(o));i.setEnabledPrevious(!a.isBefore(s))}function b(){var t;var e=P.call(this);var a=this._oYearFormat.format(e.toUTCJSDate(),true);var i=new f(e);i.setMonth(i.getMonth()+this._getMonths()-1);var o=this._oYearFormat.format(i.toUTCJSDate(),true);if(a!=o){var s=this._getLocaleData();var r=s.getIntervalPattern();t=r.replace(/\{0\}/,a).replace(/\{1\}/,o)}else{t=a}var n=this.getAggregation("header");n.setTextButton2(t)}function C(t,e){var a;var i=false;if(t.isBefore(this._oMinDate)){a=this._oMinDate;i=true}else if(t.isAfter(this._oMaxDate)){a=this._oMaxDate;i=true}else{a=t}this._setFocusedDate(a);if(i||e){H.call(this,a);k.call(this,false);this.fireStartDateChange()}}function F(t,e){if(!t){return}var a=f.fromLocalJSDate(t);if(this._oFocusedDate&&this._oFocusedDate.isSame(a)){return}var i=a.getYear();h._checkYearInValidRange(i);if(h._isOutside(a,this._oMinDate,this._oMaxDate)){throw new Error("Date must not be in valid range (minDate and maxDate); "+this)}this._setFocusedDate(a);if(this.getDomRef()&&this._iMode==0){k.call(this,e)}}function Y(t){var e;if(this.getPickerPopup()){this._showCalendarPicker()}else{if(this._iMode!=1){e=function(){var t=this.getAggregation("yearPicker");t.focus();t.removeDelegate(e)};x.call(this);this.getAggregation("yearPicker").addDelegate({onAfterRendering:e},this)}else{R.call(this)}}}m.prototype._showCalendarPicker=function(){var t=this._getFocusedDate(true).toLocalJSDate();var e=this._getCalendarPicker();var a=new v({startDate:t});var i=f.fromLocalJSDate(t);e.displayDate(t,false);i.setMonth(0,1);e._getYearPicker().setProperty("_middleDate",i);e.removeAllSelectedDates();e.addSelectedDate(a);e.setMinDate(this.getMinDate());e.setMaxDate(this.getMaxDate());V.call(this,e);this._showOverlay()};function L(t){if(this._oPopup&&this._oPopup.isOpen()){this._oPopup.close()}this._hideOverlay();if(!t){k.call(this);var e=this.getAggregation("monthsRow");jQuery(e._oItemNavigation.getItemDomRefs()[e._oItemNavigation.getFocusedIndex()]).attr("tabindex","0")}}function N(t){this.fireSelect()}function B(t){var e=f.fromLocalJSDate(t.getParameter("date"));var a=t.getParameter("notVisible");C.call(this,e,a)}function J(t){var e=new f(this._getFocusedDate());var a=this._getCalendarPicker();var i=a.getSelectedDates()[0].getStartDate();var o=f.fromLocalJSDate(i);o.setMonth(e.getMonth());o.setDate(e.getDate());C.call(this,o,true);L.call(this)}function O(t){var e=new f(this._getFocusedDate());var a=this.getAggregation("yearPicker");var i=f.fromLocalJSDate(a.getDate());var o={onAfterRendering:function(){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex());this.removeDelegate(o)}};var s=this.getAggregation("monthsRow");i.setMonth(e.getMonth());i.setDate(e.getDate());e=i;C.call(this,e,true);R.call(this);s.addDelegate(o,s)}function E(){this._sInvalidateContent=undefined;var t=this.getAggregation("monthsRow");if(t){t._bDateRangeChanged=true;t._bInvalidateSync=true;t.invalidate();t._bInvalidateSync=undefined}this._bDateRangeChanged=undefined}function H(t){var e=this.getAggregation("monthsRow");var a=P.call(this);var i=e._oItemNavigation.getFocusedIndex();a=new f(t);a.setMonth(a.getMonth()-i);y.call(this,a,false,true)}function V(e){if(!this._oPopup){var a=new t({placement:"VerticalPreferredBottom",showHeader:false,showArrow:false,verticalScrolling:false});a.oPopup.setDurations(0,0);a.addEventDelegate({onsapescape:function(t){this._oCustomYearPicker.onsapescape(t);this._hideOverlay()}},this);this._oPopup=a}this._oPopup.addContent(e);this._oPopup.attachAfterClose(function(){this._hideOverlay()},this);this._oPopup.attachAfterOpen(function(){var t=o.$("B2");var e=this._oPopup.$();var a=Math.floor((e.width()-t.width())/2);this._oPopup.setOffsetX(i.getConfiguration().getRTL()?a:-a);var s=t.height();this._oPopup.setOffsetY(this._oPopup._getCalculatedPlacement()==="Top"?s:-s)},this);var o=this.getAggregation("header");this._oPopup.openBy(o.getDomRef("B2"))}function T(t){S.call(this)}return m});
//# sourceMappingURL=CalendarMonthInterval.js.map