/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Element","sap/ui/core/Control","sap/ui/core/Core"],function(jQuery,e,t){"use strict";jQuery.sap.require("sap.ui.qunit.qunit-css");jQuery.sap.require("sap.ui.thirdparty.qunit");jQuery.sap.require("sap.ui.qunit.qunit-junit");jQuery.sap.require("sap.ui.qunit.qunit-coverage");QUnit.config.reorder=false;var o={};function n(){return e.registry.all()}var r=function(e){var t=e.getMetadata().getAllProperties();for(var o in t){if(e.isPropertyInitial(o)){var n=t[o];try{e[n._sMutator]("dummyValueForMemLeakTest")}catch(e){}}}if(!e.getTooltip()){e.setTooltip("test")}};var a=function(e,o,a,l){QUnit.test("Control "+e+" should not have any memory leaks",function(e){var s=o();e.ok(s,"calling fnControlFactory() should return something (a control)");e.ok(s instanceof t,"calling fnControlFactory() should return something that is really instanceof sap.ui.core.Control");if(s.placeAt&&!l){try{s.getMetadata().getRenderer()}catch(t){e.ok(false,"Error: control does not have a renderer. If this is known, please set the 'bControlCannotRender' flag when calling MemoryLeakCheck.checkControl")}}r(s);if(s.placeAt&&!l){try{s.placeAt("qunit-fixture");sap.ui.getCore().applyChanges()}catch(t){e.ok(false,"Error: control has a renderer, but could not be rendered. If this is known, please set the 'bControlCannotRender' flag when calling MemoryLeakCheck.checkControl");throw t}}if(a){a(s);sap.ui.getCore().applyChanges()}s.destroy();sap.ui.getCore().applyChanges();var c=n(),u=o();r(u);if(u.placeAt&&!l){u.placeAt("qunit-fixture");sap.ui.getCore().applyChanges();u.rerender();sap.ui.getCore().applyChanges()}if(a){a(u);sap.ui.getCore().applyChanges()}u.destroy();sap.ui.getCore().applyChanges();var f=n();i(e,f,c,"Memory leak check should not find any leftover controls after creating two instances and rendering twice"+(a?"\n(and calling fnSomeAdditionalFunction)":""))})};var i=function(e,t,o,n){var r=[];for(var a in t){if(!o[a]){r.push(t[a])}}for(var i=0;i<r.length;i++){if(typeof r[i].getText==="function"){r[i]+=" (text: '"+r[i].getText()+"')"}}n=n+(r.length>0?". LEFTOVERS: "+r.join(", "):"");e.equal(r.length,0,n)};o.checkControl=function(t,o,r,i){if(typeof t!=="string"){i=r;r=o;o=t;t="[some control, id: "+Math.random()+" - please update your test to also pass the control name]"}if(r===true||r===false){i=r;r=undefined}var l;QUnit.module("MemoryLeakCheck.checkControl: "+t,{beforeEach:function(){l=n()},afterEach:function(t){e.registry.forEach(function(e,o){if(!l[o]){t.ok(e.getMetadata().getName(),"Cleanup of id: "+o+", control: "+e.getMetadata().getName());e.destroy()}})}});QUnit.test("MemoryLeakCheck.checkControl(fnControlFactory) should receive a control factory",function(e){e.equal(typeof o,"function","MemoryLeakCheck should have received a control factory");e.ok(document.getElementById("qunit-fixture"),"the test page HTML should contain an element with ID 'qunit-fixture'")});a(t,o,r,i)};return o},true);
//# sourceMappingURL=MemoryLeakCheck.js.map