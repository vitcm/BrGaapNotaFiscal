/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./LabelEnablement","sap/ui/base/Object","sap/ui/performance/trace/Interaction","sap/base/util/uid","sap/ui/util/ActivityDetection","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/security/encodeCSS","sap/base/assert","sap/ui/performance/Measurement","sap/base/Log","sap/base/util/extend","./InvisibleRenderer","./Patcher"],function(e,t,r,n,i,jQuery,s,a,o,l,u,f,d,c){"use strict";var p=["renderControl","cleanupControlWithoutRendering","accessibilityState","icon"];var h=["write","writeEscaped","writeAcceleratorKey","writeControlData","writeElementData","writeAttribute","writeAttributeEscaped","addClass","writeClasses","addStyle","writeStyles","writeAccessibilityState","writeIcon","translate","getConfiguration","getHTML"];var g=["openStart","voidStart","attr","class","style","openEnd","voidEnd","text","unsafeHtml","close"];var m=["render","flush","destroy"];var y=document.createElement("template");var v="data-sap-ui-stylekey";function b(){var e=this,n,a,f,w,E,S,I="",P=false,R,D="",N={},x={},_=[];this._setFocusHandler=function(e){o(e&&t.isA(e,"sap.ui.core.FocusHandler"),"oFocusHandler must be an sap.ui.core.FocusHandler");n=e};function H(){a=e.aBuffer=[];f=e.aRenderedControls=[];w=e.aStyleStack=[{}];R=undefined;P=false;I=""}function O(e,t){o(e&&typeof e=="string"&&/^[a-z_][a-zA-Z0-9_\-]*$/.test(e),"The "+t+" name provided '"+e+"' is not valid; it must contain alphanumeric characters, hyphens or underscores")}function j(e){o(I,"There is no open tag; '"+e+"' must not be called without an open tag")}function B(e){var t=e===undefined?!I:e;o(t,"There is an open tag; '"+I+"' tag has not yet ended with '"+(P?"voidEnd":"openEnd")+"'")}function L(e){O(e,"attr");o(e!="class"&&e!="style","Attributes 'class' and 'style' must not be written, instead use dedicated 'class' or 'style' method")}function k(e){o(typeof e=="string"&&!/\s/.test(e)&&arguments.length===1,"Method 'class' must be called with exactly one class name")}function F(e){o(e&&typeof e=="string"&&!/\s/.test(e),"Method 'style' must be called with a non-empty string name")}this.write=function(e){o(typeof e==="string"||typeof e==="number","sText must be a string or number");a.push.apply(a,arguments);return this};this.writeEscaped=function(e,t){if(e!=null){e=s(String(e));if(t){e=e.replace(/&#xa;/g,"<br>")}a.push(e)}return this};this.writeAttribute=function(e,t){o(typeof e==="string","sName must be a string");o(typeof t==="string"||typeof t==="number"||typeof t==="boolean","value must be a string, number or boolean");a.push(" ",e,'="',t,'"');return this};this.writeAttributeEscaped=function(e,t){o(typeof e==="string","sName must be a string");a.push(" ",e,'="',s(String(t)),'"');return this};this.addStyle=function(e,t){o(typeof e==="string","sName must be a string");if(t!=null&&t!=""){o(typeof t==="string"||typeof t==="number","value must be a string or number");var r=w[w.length-1];if(!r.aStyle){r.aStyle=[]}r.aStyle.push(e+": "+t+";")}return this};this.writeStyles=function(){var e=w[w.length-1];if(e.aStyle&&e.aStyle.length){this.writeAttribute(v,_.push(e.aStyle.join(" "))-1)}e.aStyle=null;return this};this.addClass=function(e){if(e){o(typeof e==="string","sName must be a string");var t=w[w.length-1];if(!t.aClasses){t.aClasses=[]}t.aClasses.push(e)}return this};this.writeClasses=function(e){o(!e||typeof e==="boolean"||t.isA(e,"sap.ui.core.Element"),"oElement must be empty, a boolean, or an sap.ui.core.Element");var r=w[w.length-1];var n;if(e){n=e.aCustomStyleClasses}else if(e===false){n=[]}else{n=r.aCustomStyleClasses}if(r.aClasses||n){var i=[].concat(r.aClasses||[],n||[]);if(i.length){this.writeAttribute("class",i.join(" "))}}if(!e){r.aCustomStyleClasses=null}r.aClasses=null;return this};this.openStart=function(e,t){O(e,"tag");B();I=e;this.write("<"+e);if(t){if(typeof t=="string"){this.attr("id",t)}else{this.writeElementData(t)}}return this};this.openEnd=function(e){j("openEnd");B(!P);o(e===undefined||e===true,"The private parameter bExludeStyleClasses must be true or omitted!");I="";this.writeClasses(e===true?false:undefined);this.writeStyles();this.write(">");return this};this.close=function(e){O(e,"tag");B();this.write("</"+e+">");return this};this.voidStart=function(e,t){this.openStart(e,t);P=true;return this};this.voidEnd=function(e){j("voidEnd");B(P||!I);P=false;I="";this.writeClasses(e?false:undefined);this.writeStyles();this.write(">");return this};this.unsafeHtml=function(e){B();this.write(e);return this};this.text=function(e){B();this.writeEscaped(e);return this};this.attr=function(e,t){L(e);this.writeAttributeEscaped(e,t);return this};this.class=function(e){if(e){k.apply(this,arguments);this.addClass(s(e))}return this};this.style=function(e,t){F(e);this.addStyle(e,t);return this};this.accessibilityState=this.writeAccessibilityState;this.icon=this.writeIcon;x.openStart=function(e,t){O(e,"tag");B();I=e;if(!t){c.openStart(e)}else if(typeof t=="string"){c.openStart(e,t)}else{c.openStart(e,t.getId());T(this,t)}return this};x.voidStart=function(e,t){this.openStart(e,t);P=true;return this};x.attr=function(e,t){L(e);j("attr");c.attr(e,t);return this};x.class=function(e){if(e){k.apply(this,arguments);j("class");c.class(e)}return this};x.style=function(e,t){F(e);j("style");c.style(e,t);return this};x.openEnd=function(e){if(e!==true){var t=w[w.length-1];var r=t.aCustomStyleClasses;if(r){r.forEach(c.class,c);t.aCustomStyleClasses=null}}j("openEnd");B(!P);o(e===undefined||e===true,"The private parameter bExludeStyleClasses must be true or omitted!");I="";c.openEnd();return this};x.voidEnd=function(e){if(!e){var t=w[w.length-1];var r=t.aCustomStyleClasses;if(r){r.forEach(c.class,c);t.aCustomStyleClasses=null}}j("voidEnd");B(P||!I);P=false;I="";c.voidEnd();return this};x.text=function(e){B();if(e!=null){c.text(e)}return this};x.unsafeHtml=function(e){B();c.unsafeHtml(e);return this};x.close=function(e){O(e,"tag");B();c.close(e);return this};function U(e){S=true;try{var t=new jQuery.Event("BeforeRendering");t.srcControl=e;e._handleEvent(t)}finally{S=false}}this.cleanupControlWithoutRendering=function(e){o(!e||t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control or empty");if(!e){return}var r=e.getDomRef();if(r){U(e);b.preserveContent(r,false,false);if(!r.hasAttribute(A)){e.bOutput=false}}};this.renderControl=function(e){o(!e||t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control or empty");if(!e){return this}if(!E){E=[]}if(E&&E.length>0){l.pause(E[0]+"---renderControl")}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){l.pause(e.getParent().getId()+"---rerender")}E.unshift(e.getId());l.start(e.getId()+"---renderControl","Rendering of "+e.getMetadata().getName(),["rendering","control"]);U(e);l.pause(e.getId()+"---renderControl");var r;var i=e.getMetadata();var s=e.getVisible();if(s){r=i.getRenderer()}else{var p=i.getProperty("visible");var h=p&&p._oParent&&p._oParent.getName()=="sap.ui.core.Control";r=h?d:i.getRenderer()}l.resume(e.getId()+"---renderControl");var g=e.aBindParameters,m;if(g&&g.length>0&&(m=e.getDomRef())){var y=jQuery(m);for(var v=0;v<g.length;v++){var C=g[v];y.off(C.sEventType,C.fnProxy)}}if(r&&typeof r.render==="function"){if(a.length){R=false}else if(R===undefined){if(b.getApiVersion(r)==2){m=m||e.getDomRef()||d.getDomRef(e);if(b.isPreservedContent(m)){R=false}else{if(m&&n){n.storePatchingControlFocusInfo(m)}c.setRootNode(m);R=true}}else{R=false}}else if(!D&&R){if(b.getApiVersion(r)!=2){D=e.getId();R=false}}var A={};if(e.aCustomStyleClasses&&e.aCustomStyleClasses.length>0){A.aCustomStyleClasses=e.aCustomStyleClasses}w.push(A);if(R){var S=c.getCurrentNode();r.render(x,e);if(c.getCurrentNode()==S){c.unsafeHtml("",e.getId());e.bOutput=false}else{e.bOutput=true}}else{var I=a.length;r.render(N,e);e.bOutput=a.length!==I}w.pop();if(D&&D===e.getId()){c.unsafeHtml(a.join(""),D,G);D="";R=true;a=[]}}else{u.error("The renderer for class "+i.getName()+" is not defined or does not define a render function! Rendering of "+e.getId()+" will be skipped!")}f.push(e);var P=e.getUIArea();if(P){P._onControlRendered(e)}if(r===d){e.bOutput="invisible"}l.end(e.getId()+"---renderControl");E.shift();if(E&&E.length>0){l.resume(E[0]+"---renderControl")}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){l.resume(e.getParent().getId()+"---rerender")}return this};this.getHTML=function(e){o(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");var r=a;var n=a=this.aBuffer=[];this.renderControl(e);a=this.aBuffer=r;return n.join("")};function V(e){var t,r=f.length;for(t=0;t<r;t++){f[t]._sapui_bInAfterRenderingPhase=true}S=true;try{for(t=0;t<r;t++){var i=f[t];if(i.bOutput&&i.bOutput!=="invisible"){var s=new jQuery.Event("AfterRendering");s.srcControl=i;l.start(i.getId()+"---AfterRendering","AfterRendering of "+i.getMetadata().getName(),["rendering","after"]);i._handleEvent(s);l.end(i.getId()+"---AfterRendering")}}}finally{for(t=0;t<r;t++){delete f[t]._sapui_bInAfterRenderingPhase}S=false}try{n.restoreFocus(e)}catch(e){u.warning("Problems while restoring the focus after rendering: "+e,null)}for(t=0;t<r;t++){var i=f[t],a=i.aBindParameters,o;if(a&&a.length>0&&(o=i.getDomRef())){var d=jQuery(o);for(var c=0;c<a.length;c++){var p=a[c];d.on(p.sEventType,p.fnProxy)}}}}function q(e,t,r){var s;if(!R){s=n&&n.getControlFocusInfo();var o=a.join("");if(o&&_.length){if(r instanceof SVGElement&&r.localName!="foreignObject"){y.innerHTML="<svg>"+o+"</svg>";y.replaceWith.apply(y.content.firstChild,y.content.firstChild.childNodes)}else{y.innerHTML=o}G(y.content.childNodes);e(y.content)}else{e(o)}}else{var l=c.getRootNode();if(l.nodeType==11){s=n&&n.getControlFocusInfo();e(l.lastChild?l:"")}else{s=n&&n.getPatchingControlFocusInfo()}c.reset()}V(s);H();i.refresh();if(t){t()}}function W(e,t){var r=e.getAttribute(v);if(r!=t){return 0}e.style=_[t];e.removeAttribute(v);return 1}function G(e){if(!_.length){return}var t=0;e.forEach(function(e){if(e.nodeType==1){t+=W(e,t);e.querySelectorAll("["+v+"]").forEach(function(e){t+=W(e,t)})}});_=[]}this.flush=function(e,t,n){o(typeof e==="object"&&e.ownerDocument==document,"oTargetDomNode must be a DOM element");var i=r.notifyAsyncStep();if(!t&&typeof n!=="number"&&!n){b.preserveContent(e)}q(function(t){for(var r=0;r<f.length;r++){var i=f[r].getDomRef();if(i&&!b.isPreservedContent(i)){if(b.isInlineTemplate(i)){jQuery(i).empty()}else{jQuery(i).remove()}}}if(typeof n==="number"){if(n<=0){M(e,"prepend",t)}else{var s=e.children[n-1];if(s){M(s,"after",t)}else{M(e,"append",t)}}}else if(!n){jQuery(e).html(t)}else{M(e,"append",t)}},i,e)};this.render=function(e,n){o(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be a control");o(typeof n==="object"&&n.ownerDocument==document,"oTargetDomNode must be a DOM element");if(S){u.error("Render must not be called within Before or After Rendering Phase. Call ignored.",null,this);return}var i=r.notifyAsyncStep();H();this.renderControl(e);q(function(t){if(e&&n){var r=e.getDomRef();if(!r||b.isPreservedContent(r)){r=d.getDomRef(e)||document.getElementById(C.Dummy+e.getId())}var i=r&&r.parentNode!=n;if(i){if(!b.isPreservedContent(r)){if(b.isInlineTemplate(r)){jQuery(r).empty()}else{jQuery(r).remove()}}if(t){M(n,"append",t)}}else{if(t){if(r){if(b.isInlineTemplate(r)){jQuery(r).html(t)}else{M(r,"after",t);jQuery(r).remove()}}else{M(n,"append",t)}}else{if(b.isInlineTemplate(r)){jQuery(r).empty()}else{if(!e.getParent()||!e.getParent()._onChildRerenderedEmpty||!e.getParent()._onChildRerenderedEmpty(e,r)){jQuery(r).remove()}}}}}},i,n)};this.destroy=function(){H()};var z={};p.forEach(function(e){N[e]=x[e]=z[e]=this[e]},this);g.forEach(function(e){N[e]=z[e]=this[e]},this);h.forEach(function(e){N[e]=z[e]=this[e]},this);m.forEach(function(e){z[e]=this[e]},this);this.getRendererInterface=function(){return N};this.getInterface=function(){return z};H()}b.prototype.getConfiguration=function(){return sap.ui.getCore().getConfiguration()};b.prototype.translate=function(e){};b.prototype.writeAcceleratorKey=function(){return this};b.prototype.writeControlData=function(e){o(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");this.writeElementData(e);return this};b.prototype.writeElementData=function(e){o(e&&t.isA(e,"sap.ui.core.Element"),"oElement must be an sap.ui.core.Element");this.attr("id",e.getId());T(this,e);return this};b.prototype.writeAccessibilityState=function(r,n){if(!sap.ui.getCore().getConfiguration().getAccessibility()){return this}if(arguments.length==1&&!t.isA(r,"sap.ui.core.Element")){n=r;r=null}var i={};if(r!=null){var s=r.getMetadata();var a=function(e,t,n){var a=s.getProperty(e);if(a&&r[a._sGetter]()===n){i[t]="true"}};var o=function(t,n){var a=s.getAssociation(t);if(a&&a.multiple){var o=r[a._sGetter]();if(t=="ariaLabelledBy"){var l=e.getReferencingLabels(r);var u=l.length;if(u){var f=[];for(var d=0;d<u;d++){if(o.indexOf(l[d])<0){f.push(l[d])}}o=f.concat(o)}}if(o.length>0){i[n]=o.join(" ")}}};a("editable","readonly",false);a("enabled","disabled",false);a("visible","hidden",false);if(e.isRequired(r)){i["required"]="true"}a("selected","selected",true);a("checked","checked",true);o("ariaDescribedBy","describedby");o("ariaLabelledBy","labelledby")}if(n){var l=function(e){var t=typeof e;return e===null||t==="number"||t==="string"||t==="boolean"};var u={};var f,d,c;for(f in n){d=n[f];if(l(d)){u[f]=d}else if(typeof d==="object"&&l(d.value)){c="";if(d.append&&(f==="describedby"||f==="labelledby")){c=i[f]?i[f]+" ":""}u[f]=c+d.value}}Object.assign(i,u)}if(t.isA(r,"sap.ui.core.Element")&&r.getParent()&&r.getParent().enhanceAccessibilityState){r.getParent().enhanceAccessibilityState(r,i)}for(var p in i){if(i[p]!=null&&i[p]!==""){this.attr(p==="role"?p:"aria-"+p,i[p])}}return this};b.prototype.writeIcon=function(e,t,r){var i=sap.ui.requireSync("sap/ui/core/IconPool"),s=i.isIconURI(e),o=false,l,d,c,p,h;if(typeof t==="string"){t=[t]}if(s){d=i.getIconInfo(e);if(!d){u.error("An unregistered icon: "+e+" is used in sap.ui.core.RenderManager's writeIcon method.");return this}if(!t){t=[]}t.push("sapUiIcon");if(!d.suppressMirroring){t.push("sapUiIconMirrorInRTL")}}if(s){this.openStart("span")}else{this.voidStart("img")}if(Array.isArray(t)){t.forEach(function(e){this.class(e)},this)}if(s){c={"data-sap-ui-icon-content":d.content,role:"presentation",title:d.text||null};this.style("font-family","'"+a(d.fontFamily)+"'")}else{c={role:"presentation",alt:"",src:e}}r=f(c,r);if(!r.id){r.id=n()}if(s){p=r.alt||r.title||d.text||d.name;h=r.id+"-label";if(r["aria-labelledby"]){o=true;r["aria-labelledby"]+=" "+h}else if(!r.hasOwnProperty("aria-label")){r["aria-label"]=p}}if(typeof r==="object"){for(l in r){if(r.hasOwnProperty(l)&&r[l]!==null){this.attr(l,r[l])}}}if(s){this.openEnd();if(o){this.openStart("span");this.style("display","none");this.attr("id",h);this.openEnd();this.text(p);this.close("span")}this.close("span")}else{this.voidEnd()}return this};b.prototype.getRenderer=function(e){o(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");return b.getRenderer(e)};var C=b.RenderPrefixes={Invisible:d.PlaceholderPrefix,Dummy:"sap-ui-dummy-",Temporary:"sap-ui-tmp-"};b.getRenderer=function(e){o(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");return e.getMetadata().getRenderer()};b.forceRepaint=function(e){var t=e?window.document.getElementById(e):null;var r=typeof e=="string"?t:e;if(r){u.debug("forcing a repaint for "+(r.id||String(r)));var n=r.style.display;var i=document.activeElement;r.style.display="none";r.offsetHeight;r.style.display=n;if(document.activeElement!==i&&i){i.focus()}}};b.createInvisiblePlaceholderId=function(e){return d.createInvisiblePlaceholderId(e)};var w="sap-ui-preserve",E="sap-ui-static",A="data-sap-ui-preserve",S="data-sap-ui-area";function I(){var e=jQuery(document.getElementById(w));if(e.length===0){e=jQuery("<div></div>",{"aria-hidden":"true",id:w}).addClass("sapUiHidden").addClass("sapUiForcedHidden").css("width","0").css("height","0").css("overflow","hidden").appendTo(document.body)}return e}function P(e){jQuery("<div></div>",{id:C.Dummy+e.id}).addClass("sapUiHidden").insertBefore(e)}var R=[];b.attachPreserveContent=function(e,t){b.detachPreserveContent(e);R.push({fn:e,context:t})};b.detachPreserveContent=function(e){R=R.filter(function(t){return t.fn!==e})};b.preserveContent=function(e,t,r,n){o(typeof e==="object"&&e.ownerDocument==document,"oRootNode must be a DOM element");R.forEach(function(t){t.fn.call(t.context||b,{domNode:e})});var i=I();function s(t){while(t&&t!=e&&t.parentNode){t=t.parentNode;if(t.hasAttribute(A)){return true}if(t.hasAttribute("data-sap-ui")){break}}}function a(e,t,r){if(e===t){return true}for(var n=t.getParent();n;n=n.isA("sap.ui.core.UIComponent")?n.oContainer:n.getParent()){if(n.isA("sap.ui.core.Control")){if(!n.getVisible()){return false}var i=n.getDomRef();if(i&&!i.contains(r)){return false}}if(n===e){return true}}}function u(t){if(t.id===w||t.id===E){return}var o=t.getAttribute(A);if(o){if(n){var l=sap.ui.getCore().byId(o);if(l&&a(n,l,t)){return}}if(t===e||s(t)){P(t)}i.append(t)}else if(r&&t.id){b.markPreservableContent(jQuery(t),t.id);i.append(t);return}if(!t.hasAttribute(S)){var f=t.firstChild;while(f){t=f;f=f.nextSibling;if(t.nodeType===1){u(t)}}}}l.start(e.id+"---preserveContent","preserveContent for "+e.id,["rendering","preserve"]);if(t){u(e)}else{jQuery(e).children().each(function(e,t){u(t)})}l.end(e.id+"---preserveContent")};b.findPreservedContent=function(e){o(typeof e==="string","sId must be a string");var t=I(),r=t.children("["+A+"='"+e.replace(/(:|\.)/g,"\\$1")+"']");return r};b.markPreservableContent=function(e,t){e.attr(A,t)};b.isPreservedContent=function(e){return e&&e.getAttribute(A)&&e.parentNode&&e.parentNode.id==w};b.getPreserveAreaRef=function(){return I()[0]};var D="data-sap-ui-template";b.markInlineTemplate=function(e){e.attr(D,"")};b.isInlineTemplate=function(e){return e&&e.hasAttribute(D)};b.getApiVersion=function(e){if(e.hasOwnProperty("apiVersion")){return e.apiVersion}return 1};function T(e,t){var r=t.getId();e.attr("data-sap-ui",r);if(t.__slot){e.attr("slot",t.__slot)}t.getCustomData().forEach(function(r){var n=r._checkWriteToDom(t);if(n){e.attr(n.key.toLowerCase(),n.value)}});var n=t.getDragDropConfig().some(function(e){return e.isDraggable(t)});if(!n){var i=t.getParent();if(i&&i.getDragDropConfig){n=i.getDragDropConfig().some(function(e){return e.isDraggable(t)})}}if(n){e.attr("draggable","true");e.attr("data-sap-ui-draggable","true")}return this}var N={before:"beforebegin",prepend:"afterbegin",append:"beforeend",after:"afterend"};function M(e,t,r){if(typeof r=="string"){e.insertAdjacentHTML(N[t],r)}else{e[t](r)}}return b},true);
//# sourceMappingURL=RenderManager.js.map