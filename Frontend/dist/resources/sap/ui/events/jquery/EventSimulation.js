/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/Version","sap/ui/events/PseudoEvents","sap/ui/events/checkMouseEnterOrLeave","sap/ui/events/ControlEvents","sap/ui/Device","sap/ui/events/TouchToMouseMapping","sap/ui/thirdparty/jquery","sap/ui/thirdparty/jquery-mobile-custom","sap/ui/dom/jquery/control"],function(e,t,n,o,a,i,jQuery){"use strict";var s={};var u=e(jQuery.fn.jquery);s.aAdditionalControlEvents=[];s.aAdditionalPseudoEvents=[];s._createSimulatedEvent=function(e,t,n){var o="__"+e+"Handler";var a="sap"+e;this.aAdditionalControlEvents.push(a);this.aAdditionalPseudoEvents.push({sName:e,aTypes:[a],fnCheck:function(e){return true}});jQuery.event.special[a]={add:function(o){var i=this,s=jQuery(this),u={domRef:i,eventName:e,sapEventName:a,eventHandle:o};var r=function(e){n(e,u)};o.__sapSimulatedEventHandler=r;for(var c=0;c<t.length;c++){s.on(t[c],r)}},remove:function(e){var n=jQuery(this);var a=e.__sapSimulatedEventHandler;n.removeData(o+e.guid);for(var i=0;i<t.length;i++){jQuery.event.remove(this,t[i],a)}}}};s._handleMouseToTouchEvent=function(e,t){if(e.isMarked("delayedMouseEvent")){return}var o=jQuery(t.domRef),a=jQuery.fn.control?jQuery(e.target).control(0):null,i=o.data("__touchstart_control"),s=i&&window.document.getElementById(i);if(e.type==="mouseout"&&!n(e,t.domRef)&&(!s||!n(e,s))){return}var u=jQuery.event.fix(e.originalEvent||e);u.type=t.sapEventName;if(u.isMarked("firstUIArea")){u.setMark("handledByUIArea",false)}var r=[{identifier:1,pageX:u.pageX,pageY:u.pageY,clientX:u.clientX,clientY:u.clientY,screenX:u.screenX,screenY:u.screenY,target:u.target,radiusX:1,radiusY:1,rotationAngle:0}];switch(t.eventName){case"touchstart":if(a){o.data("__touchstart_control",a.getId())}case"touchmove":u.touches=u.changedTouches=u.targetTouches=r;break;case"touchend":u.changedTouches=r;u.touches=u.targetTouches=[];break}if(t.eventName==="touchstart"||o.data("__touch_in_progress")){o.data("__touch_in_progress","X");if(e.type==="mouseout"){u.setMarked("fromMouseout")}if(t.eventName!=="touchstart"&&(!a||a.getId()!==i)){u.setMark("scopeCheckId",i)}if(e.type!=="dragstart"){t.eventHandle.handler.call(t.domRef,u)}if((t.eventName==="touchend"||e.type==="dragstart")&&!u.isMarked("fromMouseout")){o.removeData("__touch_in_progress");o.removeData("__touchstart_control")}}};s._initTouchEventSimulation=function(){this._createSimulatedEvent("touchstart",["mousedown"],this._handleMouseToTouchEvent);this._createSimulatedEvent("touchend",["mouseup","mouseout"],this._handleMouseToTouchEvent);this._createSimulatedEvent("touchmove",["mousemove","dragstart"],this._handleMouseToTouchEvent)};s._initContextMenuSimulation=function(){var e=function(e,t){var n=jQuery.event.fix(e.originalEvent||e);n.type=t.sapEventName;if(!window.getSelection||!window.getSelection()||window.getSelection().toString()===""){t.eventHandle.handler.call(t.domRef,n)}};this._createSimulatedEvent("contextmenu",["taphold"],e)};s._initMouseEventSimulation=function(e){var t=false,n=jQuery.vmouse.moveDistanceThreshold,o,a,i,s,u;var r=function(e,t,n){var o=jQuery.event.fix(e.originalEvent||e);o.type=t.sapEventName;delete o.touches;delete o.changedTouches;delete o.targetTouches;o.screenX=n.screenX;o.screenY=n.screenY;o.clientX=n.clientX;o.clientY=n.clientY;o.ctrlKey=n.ctrlKey;o.altKey=n.altKey;o.shiftKey=n.shiftKey;o.button=0;return o};var c=function(i,s){if(i.isMarked("handledByTouchToMouse")){return}i.setMarked("handledByTouchToMouse");if(!t){var c=i.originalEvent.touches[0];t=Math.abs(c.pageX-o)>n||Math.abs(c.pageY-a)>n}if(e){if(u&&i.timeStamp-u<50){return}u=i.timeStamp}var d=r(i,s,i.touches[0]);setTimeout(function(){d.setMark("handledByUIArea",false);s.eventHandle.handler.call(s.domRef,d)},0)};var d=function(e,n){if(e.isMarked("handledByTouchToMouse")){return}e.setMarked("handledByTouchToMouse");var c,d,l;function h(){return r(e,n,n.eventName==="mouseup"?e.changedTouches[0]:e.touches[0])}if(e.type==="touchstart"){var v=e.originalEvent.touches[0];t=false;u=0;o=v.pageX;a=v.pageY;i=Math.round(v.pageX-jQuery(e.target).offset().left);s=Math.round(v.pageY-jQuery(e.target).offset().top);c=h();setTimeout(function(){c.setMark("handledByUIArea",false);n.eventHandle.handler.call(n.domRef,c)},0)}else if(e.type==="touchend"){d=h();l=!t;setTimeout(function(){d.setMark("handledByUIArea",false);n.eventHandle.handler.call(n.domRef,d);if(l){d.type="click";d.getPseudoTypes=jQuery.Event.prototype.getPseudoTypes;d.setMark("handledByUIArea",false);d.offsetX=i;d.offsetY=s;n.eventHandle.handler.call(n.domRef,d)}},0)}};this._createSimulatedEvent("mousedown",["touchstart"],d);this._createSimulatedEvent("mousemove",["touchmove"],c);this._createSimulatedEvent("mouseup",["touchend","touchcancel"],d)};s._init=function(e){this.aAdditionalControlEvents.push("swipe","tap","swipeleft","swiperight","scrollstart","scrollstop");this.aAdditionalPseudoEvents.push({sName:"swipebegin",aTypes:["swipeleft","swiperight"],fnCheck:function(e){var t=sap.ui.getCore().getConfiguration().getRTL();return t&&e.type==="swiperight"||!t&&e.type==="swipeleft"}});this.aAdditionalPseudoEvents.push({sName:"swipeend",aTypes:["swipeleft","swiperight"],fnCheck:function(e){var t=sap.ui.getCore().getConfiguration().getRTL();return!t&&e.type==="swiperight"||t&&e.type==="swipeleft"}});if(u.compareTo("1.9.1")<0){e=e.concat(this.aAdditionalControlEvents)}else{e=this.aAdditionalControlEvents.concat(e)}for(var n=0;n<this.aAdditionalPseudoEvents.length;n++){t.addEvent(this.aAdditionalPseudoEvents[n])}return e};if(a.browser.webkit&&/Mobile/.test(navigator.userAgent)&&a.support.touch){i.init(window.document);s.disableTouchToMouseHandling=i.disableTouchToMouseHandling}if(!s.disableTouchToMouseHandling){s.disableTouchToMouseHandling=jQuery.noop}if(a.support.touch){o.events.push("touchstart","touchend","touchmove","touchcancel")}(function e(){s.touchEventMode="SIM";if(a.support.touch){s.touchEventMode="ON";if(u.compareTo("3.0.0")<0){jQuery.event.props.push("touches","targetTouches","changedTouches")}}s._initTouchEventSimulation();if(a.os.ios){s._initContextMenuSimulation()}if(a.support.touch){s.disableTouchToMouseHandling();s._initMouseEventSimulation(a.os.blackberry)}o.events=s._init(o.events)})();return s});
//# sourceMappingURL=EventSimulation.js.map