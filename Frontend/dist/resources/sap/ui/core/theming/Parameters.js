/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","../Element","sap/base/util/UriParameters","sap/base/Log","sap/base/util/extend","sap/ui/core/ThemeCheck","sap/ui/thirdparty/jquery"],function(e,r,a,t,n,i,jQuery){"use strict";var s=window["sap-ui-config"]||{};var o=0;if(s["xx-nosync"]==="warn"||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){o=1}if(s["xx-nosync"]===true||s["xx-nosync"]==="true"||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){o=2}var u={};var f=null;var c=null;var l=[];var m=[];var p=new e(sap.ui.require.toUrl(""),document.baseURI).origin();var d={};var h=/url[\s]*\('?"?([^\'")]*)'?"?\)/;var g=a.fromQuery(window.location.search).get("sap-ui-xx-no-inline-theming-parameters")!=="true";function v(){f=null}function y(r,a){var t=h.exec(r);if(t){var n=new e(t[1]);if(n.is("relative")){var i=n.absoluteTo(a).normalize().toString();r="url('"+i+"')"}}return r}function b(e,r,a){for(var t in r){if(typeof e[t]==="undefined"){e[t]=y(r[t],a)}}return e}function w(e,r){if(typeof e["default"]!=="object"){e={default:e,scopes:{}}}f=f||{};f["default"]=f["default"]||{};f["scopes"]=f["scopes"]||{};b(f["default"],e["default"],r);if(typeof e["scopes"]==="object"){for(var a in e["scopes"]){f["scopes"][a]=f["scopes"][a]||{};b(f["scopes"][a],e["scopes"][a],r)}}}function C(e){jQuery("link[id^=sap-ui-theme-]").each(function(){e(this.getAttribute("id"))})}function x(e){var r=N(e);var a=i.checkStyle(e);if(!a){t.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters")}if(a&&g){var n=jQuery(document.getElementById(e));var s=n.css("background-image");var o=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(s);if(o&&o.length>=2){var u=o[1];if(u.charAt(0)!=="{"&&u.charAt(u.length-1)!=="}"){try{u=decodeURIComponent(u)}catch(e){t.warning("Could not decode theme parameters URI from "+r.styleSheetUrl)}}try{var f=JSON.parse(u);w(f,r.themeBaseUrl);return true}catch(e){t.warning("Could not parse theme parameters from "+r.styleSheetUrl+". Loading library-parameters.json as fallback solution.")}}}return false}function P(r){var a=N(r);if(!x(r)){var n=a.styleSheetUrl.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function(e,r,a){return"/library-parameters.json"+(a?a:"")});if(o===2){t.error("[nosync] Loading library-parameters.json ignored",n,"sap.ui.core.theming.Parameters");return}else if(o===1){t.error("[nosync] Loading library-parameters.json with sync XHR",n,"sap.ui.core.theming.Parameters")}var i=new e(a.themeBaseUrl).origin();var s=d[i];var u=[];if(s===undefined){if(n.startsWith(p)){u=[false,true]}else{u=[true,false]}}else{u=[s]}j(n,a.themeBaseUrl,u)}}function N(r){var a=document.getElementById(r);if(!a){t.warning("Could not find stylesheet element with ID",r,"sap.ui.core.theming.Parameters");return undefined}var n=a.href;return{themeBaseUrl:new e(n).filename("").query("").toString(),styleSheetUrl:n}}function j(r,a,n){var i=n.shift();var s=i?{"X-Requested-With":"XMLHttpRequest"}:{};jQuery.ajax({url:r,dataType:"json",async:false,xhrFields:{withCredentials:i},headers:s,success:function(r,t,n){var s=new e(a).origin();d[s]=i;if(Array.isArray(r)){for(var o=0;o<r.length;o++){var u=r[o];w(u,a)}}else{w(r,a)}},error:function(e,s,o){t.error("Could not load theme parameters from: "+r,o);if(n.length>0){t.warning("Initial library-parameters.json request failed ('withCredentials="+i+"'; sUrl: '"+r+"').\n"+"Retrying with 'withCredentials="+!i+"'.","sap.ui.core.theming.Parameters");j(r,a,n)}}})}function U(e){if(!f){w({},"");c=sap.ui.getCore().getConfiguration().getTheme();C(function(r){if(e){if(i.checkStyle(r)){x(r)}else{l.push(r)}}else{P(r)}})}return f}function S(){var e=[];l.forEach(function(r){if(i.checkStyle(r)){x(r)}else{e.push(r)}});l=e}function I(){l.forEach(P);l=[]}u._addLibraryTheme=function(e){if(f){l.push("sap-ui-theme-"+e)}};function k(e){var r=e.async,a=U(r);if(e.scopeName){a=a["scopes"][e.scopeName]}else{a=a["default"]}var t=a[e.parameterName];if(typeof t==="undefined"&&typeof e.parameterName==="string"){var n=e.parameterName.indexOf(":");if(n!==-1){e.parameterName=e.parameterName.substr(n+1)}t=a[e.parameterName]}if(e.loadPendingParameters&&typeof t==="undefined"&&!r){I();t=k({parameterName:e.parameterName,scopeName:e.scopeName,loadPendingParameters:false})}return t}function T(e,r,a){for(var t=0;t<r.length;t++){var n=r[t];for(var i=0;i<n.length;i++){var s=n[i];var o=k({parameterName:e,scopeName:s,async:a});if(o){return o}}}return k({parameterName:e,async:a})}u._getScopes=function(e,r){if(e&&!f){return}var a=U(r);var t=Object.keys(a["scopes"]);return t};u.getActiveScopesFor=function(e,a){var t=[];if(e instanceof r){var n=e.getDomRef();if(a){S()}else{I()}var i=this._getScopes(undefined,a);if(i.length){if(n){var s=function(e){var r=n.classList;return r&&r.contains(e)};while(n){var o=i.filter(s);if(o.length>0){t.push(o)}n=n.parentNode}}else{var u=function(r){return typeof e.hasStyleClass==="function"&&e.hasStyleClass(r)};while(e){var o=i.filter(u);if(o.length>0){t.push(o)}e=typeof e.getParent==="function"&&e.getParent()}}}}return t};u.get=function(e,a){var n,i,s,o,u;var f=function(e){return e.callback===i};if(!sap.ui.getCore().isInitialized()){t.warning("Called sap.ui.core.theming.Parameters.get() before core has been initialized. "+"This could lead to bad performance and sync XHR as inline parameters might not be available, yet. "+"Consider using the API only when required, e.g. onBeforeRendering.")}if(arguments.length===0){I();var c=U();return Object.assign({},c["default"])}if(!e){return undefined}if(e instanceof Object&&!Array.isArray(e)){if(!e.name){return undefined}a=e.scopeElement;i=e.callback;o=typeof e.name==="string"?[e.name]:e.name;s=true}else{if(typeof e==="string"){o=[e]}else{o=e}t.warning("Legacy variant usage of sap.ui.core.theming.Parameters.get API detected for parameter(s): '"+o.join(", ")+"'. Use asynchronous variant instead.","LegacyParametersGet","sap.ui.support",function(){return{type:"LegacyParametersGet"}})}var l,p;var d=function(e){if(a instanceof r){var t=this.getActiveScopesFor(a,s);return T(e,t,s)}else{if(s){S()}return k({parameterName:e,loadPendingParameters:!s,async:s})}}.bind(this);p={};for(var h=0;h<o.length;h++){n=o[h];var g=d(n);if(!s||g){p[n]=g}}if(s&&i&&Object.keys(p).length!==o.length){if(!sap.ui.getCore().isThemeApplied()){l=function(){var r=this.get({name:e.name,scopeElement:e.scopeElement});if(!r||typeof r==="object"&&Object.keys(r).length!==o.length){t.error("One or more parameters could not be found.","sap.ui.core.theming.Parameters")}i(r);m.splice(m.findIndex(f),1);sap.ui.getCore().detachThemeChanged(l)}.bind(this);u=m.findIndex(f);if(u>=0){sap.ui.getCore().detachThemeChanged(m[u].eventHandler);m[u].eventHandler=l}else{m.push({callback:i,eventHandler:l})}sap.ui.getCore().attachThemeChanged(l);return undefined}else{t.error("One or more parameters could not be found.","sap.ui.core.theming.Parameters")}}return o.length===1?p[o[0]]:p};u._setOrLoadParameters=function(e){f={default:{},scopes:{}};c=sap.ui.getCore().getConfiguration().getTheme();C(function(r){var a=r.substr(13);if(e[a]){n(f["default"],e[a])}else{P(r)}})};u.reset=function(){var e=arguments[0]===true;if(!e||sap.ui.getCore().getConfiguration().getTheme()!==c){v()}};u._getThemeImage=function(e,r){e=e||"sapUiGlobalLogo";var a=u.get(e);if(a){var t=h.exec(a);if(t){a=t[1]}else if(a==="''"||a==="none"){a=null}}if(r&&!a){return sap.ui.resource("sap.ui.core","themes/base/img/1x1.gif")}return a};return u},true);
//# sourceMappingURL=Parameters.js.map