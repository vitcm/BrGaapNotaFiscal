/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/base/util/Version","sap/ui/thirdparty/jquery"],function(e,r,t,jQuery){"use strict";var a=e.extend("sap.ui.core.util.LibraryInfo",{constructor:function(){e.apply(this);this._oLibInfos={}},destroy:function(){e.prototype.destroy.apply(this,arguments);this._oLibInfos={}},getInterface:function(){return this}});a.prototype._loadLibraryMetadata=function(e,t){e=e.replace(/\//g,".");if(this._oLibInfos[e]){setTimeout(t.bind(window,this._oLibInfos[e]),0);return}var a=this,o,n,i=/themelib_(.*)/i.exec(e),l;if(!i){n=".library";o=sap.ui.require.toUrl(e.replace(/\./g,"/"))+"/"}else{n=".theme";o=sap.ui.require.toUrl("sap/ui/core/themes/"+i[1]+"/")}l=typeof a.getResourceUrl==="function"?a.getResourceUrl(o):o;jQuery.ajax({url:l+n,dataType:"xml",error:function(i,l,f){r.error("failed to load library details from '"+o+n+": "+l+", "+f);a._oLibInfos[e]={name:e,data:null,url:o};t(a._oLibInfos[e])},success:function(r,n,i){a._oLibInfos[e]={name:e,data:r,url:o};t(a._oLibInfos[e])}})};a.prototype._getLibraryInfo=function(e,r){this._loadLibraryMetadata(e,function(e){var t={libs:[],library:e.name,libraryUrl:e.url};if(e.data){var o=jQuery(e.data);t.vendor=o.find("vendor").text();t.copyright=o.find("copyright").text();t.version=o.find("version").text();t.documentation=o.find("documentation").text();t.releasenotes=o.find("releasenotes").attr("url");t.componentInfo=a.prototype._getLibraryComponentInfo(o)}r(t)})};a.prototype._getThirdPartyInfo=function(e,r){this._loadLibraryMetadata(e,function(e){var t={libs:[],library:e.name,libraryUrl:e.url};if(e.data){var a=jQuery(e.data).find("appData").find("thirdparty").children();a.each(function(r,a){if(a.nodeName==="lib"){var o=jQuery(a);var n=o.children("license");t.libs.push({displayName:o.attr("displayName"),homepage:o.attr("homepage"),license:{url:n.attr("url"),type:n.attr("type"),file:e.url+n.attr("file")}})}})}r(t)})};a.prototype._getDocuIndex=function(e,t){var a=this;this._loadLibraryMetadata(e,function(e){var o=e.name,n=e.url,i={docu:{},library:o,libraryUrl:n};if(!e.data){t(i);return}var l=jQuery(e.data).find("appData").find("documentation");var f=l.attr("indexUrl");if(!f){t(i);return}if(l.attr("resolve")=="lib"){f=e.url+f}if(typeof a.getResourceUrl==="function"){f=a.getResourceUrl(f)}jQuery.ajax({url:f,dataType:"json",error:function(e,a,o){r.error("failed to load library docu from '"+f+"': "+a+", "+o);t(i)},success:function(e,r,a){e.library=o;e.libraryUrl=n;t(e)}})})};a.prototype._getReleaseNotes=function(e,a,o){var n=this;this._loadLibraryMetadata(e,function(i){if(!i.data){o({});return}var l=a.split(".").length===3&&!/-SNAPSHOT/.test(a);var f=t(a);var s=f.getMajor();var u=f.getMinor();var c=f.getPatch();var p=jQuery(i.data).find("appData").find("releasenotes");var d=p.attr("url");var y=typeof n.getResourceUrl==="function";if(!d){r.warning("failed to load release notes for library "+e);o({});return}if(f.getSuffix()==="-SNAPSHOT"){if(u%2!=0){u=u+1;c=0}a=s+"."+u+"."+c}var m=y?n.getResourceUrl(""):window.location.href,h=/\/\d.\d{1,2}.\d{1,2}\//;if(p.attr("resolve")=="lib"){if(h.test(m)||l===false){d=i.url+d}else{d="{major}.{minor}.{patch}/"+i.url+d}}d=d.replace(/\{major\}/g,s);d=d.replace(/\{minor\}/g,u);d=d.replace(/\{patch\}/g,c);if(y){d=n.getResourceUrl(d)}jQuery.ajax({url:d,dataType:"json",error:function(t,a,n){if(a==="parsererror"){r.error("failed to parse release notes for library '"+e+", "+n)}else{r.warning("failed to load release notes for library '"+e+", "+n)}o({})},success:function(e,r,t){o(e,a)}})})};a.prototype._getLibraryComponentInfo=function(e){var r={};var t=[];var a="";e.find("ownership > component").each(function(e,r){if(r.childElementCount===0){a=r.textContent}else{var o=r.getElementsByTagName("name");if(o&&o.length>0){o=o[0].textContent;var n=r.getElementsByTagName("module");if(o&&n&&n.length>0){var i=[];for(var l=0;l<n.length;l++){var f=n[l].textContent.replace(/\//g,".");if(f){i.push(f)}}if(i.length>0){t.push({component:o,modules:i})}}}}});r["defaultComponent"]=a;if(t&&t.length>0){r["specialCases"]=t}return r};a.prototype._getActualComponent=function(e,t){function a(e,r){e=e.toLowerCase();r=r.toLowerCase();return e===r||r.match(/\*$/)&&e.indexOf(r.slice(0,-1))===0||r.match(/\.\*$/)&&e===r.slice(0,-2)}if(t){for(var o in e){if(!e[o]){r.error("No library information deployed for "+o);continue}var n;if(t.indexOf(o)===0){n=e[o].defaultComponent}var i=e[o].specialCases;if(i){for(var l=0;l<i.length;l++){var f=i[l].modules;for(var s=0;s<f.length;s++){if(a(t,f[s])){n=i[l].component}}}}if(n){return n}}}};a.prototype._getDefaultComponent=function(e){return e&&e.componentInfo&&e.componentInfo.defaultComponent};return a});
//# sourceMappingURL=LibraryInfo.js.map