/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/base/Object","sap/base/Log","sap/ui/dom/includeStylesheet","sap/ui/thirdparty/jquery"],function(e,t,a,r,jQuery){"use strict";var n=150;var s=t.extend("sap.ui.core.ThemeCheck",{constructor:function(e){this._oCore=e;this._iCount=0;this._CUSTOMCSSCHECK=/\.sapUiThemeDesignerCustomCss/i;this._CUSTOMID="sap-ui-core-customcss";this._customCSSAdded=false;this._themeCheckedForCustom=null;this._sFallbackTheme=null;this._mThemeFallback={};this._oThemeMetaDataCheckElement=null},getInterface:function(){return this},fireThemeChangedEvent:function(e){o(this);c.apply(this,[true]);if(!e&&!this._sThemeCheckId){this._oCore.fireThemeChanged({theme:this._oCore.getConfiguration().getTheme()})}}});s.themeLoaded=false;function i(e){try{return e.cssRules}catch(e){return null}}function h(e){var t=i(e);return!!t&&t.length>0}s.checkStyle=function(e,t){var r=document.getElementById(e);try{var n=false,s=false,i=false,o=false;n=!r;s=!!(r&&(r.getAttribute("data-sap-ui-ready")==="true"||r.getAttribute("data-sap-ui-ready")==="false"));i=!!(r&&r.sheet&&r.sheet.href===r.href&&h(r.sheet));o=!!(r&&r.innerHTML&&r.innerHTML.length>0);var l=n||i||o||s;if(t){a.debug("ThemeCheck: "+e+": "+l+" (noLinkElement: "+n+", sheet: "+i+", innerHtml: "+o+", linkElementFinishedLoading: "+s+")")}return l}catch(r){if(t){a.error("ThemeCheck: "+e+": Error during check styles '"+e+"'",r)}}return false};function o(e){s.themeLoaded=false;if(e._sThemeCheckId){clearTimeout(e._sThemeCheckId);e._sThemeCheckId=null;e._iCount=0;e._sFallbackTheme=null;e._mThemeFallback={};if(e._oThemeMetaDataCheckElement&&e._oThemeMetaDataCheckElement.parentNode){e._oThemeMetaDataCheckElement.parentNode.removeChild(e._oThemeMetaDataCheckElement);e._oThemeMetaDataCheckElement=null}}}function l(e){var t=e._oCore.getLoadedLibraries();var n=e._oCore.getConfiguration().getTheme();var i=e._oCore._getThemePath("sap.ui.core",n)+"custom.css";var o=n.indexOf("sap_")===0||n==="base";var l=true;var c=[];if(e._customCSSAdded&&e._themeCheckedForCustom===n){t[e._CUSTOMID]={}}function d(e,t){var r=s.checkStyle(e+t,true);if(r){var n=document.querySelectorAll("link[data-sap-ui-foucmarker='"+e+t+"']");if(n.length>0){for(var i=0,h=n.length;i<h;i++){n[i].parentNode.removeChild(n[i])}a.debug("ThemeCheck: Old stylesheets removed for library: "+t)}}return r}function C(s){var u="sap-ui-theme-"+s;var C=d("sap-ui-theme-",s);if(C&&document.getElementById("sap-ui-themeskeleton-"+s)){C=d("sap-ui-themeskeleton-",s)}l=l&&C;if(l){if(e._themeCheckedForCustom!=n){if(!o&&m(e,s)){var f=i;var g=e._oCore._getLibraryCssQueryParams(t["sap.ui.core"]);if(g){f+=g}r(f,e._CUSTOMID);e._customCSSAdded=true;a.debug("ThemeCheck: delivered custom CSS needs to be loaded, Theme not yet applied");e._themeCheckedForCustom=n;l=false;return false}else{var _=jQuery("LINK[id='"+e._CUSTOMID+"']");if(_.length>0){_.remove();a.debug("ThemeCheck: Custom CSS removed")}e._customCSSAdded=false}}}if(!o&&C&&!e._mThemeFallback[s]){var T=document.getElementById(u);if(T&&T.getAttribute("data-sap-ui-ready")==="false"&&!(T.sheet&&h(T.sheet))){c.push(s)}}}jQuery.each(t,C);if(c.length>0){if(!e._sFallbackTheme){if(!e._oThemeMetaDataCheckElement){e._oThemeMetaDataCheckElement=document.createElement("span");jQuery.each(t,function(t){var a="sapThemeMetaData-UI5-"+t.replace(/\./g,"-");e._oThemeMetaDataCheckElement.classList.add(a)});document.documentElement.appendChild(e._oThemeMetaDataCheckElement)}e._sFallbackTheme=u(e._oThemeMetaDataCheckElement)}if(e._sFallbackTheme){c.forEach(function(t){var r="sap-ui-theme-"+t;var s=document.getElementById(r);a.warning("ThemeCheck: Custom theme '"+n+"' could not be loaded for library '"+t+"'. "+"Falling back to its base theme '"+e._sFallbackTheme+"'.");e._oCore._updateThemeUrl(s,e._sFallbackTheme);e._mThemeFallback[t]=true});l=false}}if(!l){a.debug("ThemeCheck: Theme not yet applied.")}else{e._themeCheckedForCustom=n}return l}function u(e){function t(){var t=window.getComputedStyle(e).getPropertyValue("background-image");var a=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)/i.exec(t);if(!a||a.length<2){return null}var r=a[1];if(r.charAt(0)!=="{"&&r.charAt(r.length-1)!=="}"){try{r=decodeURI(r)}catch(e){}}r=r.replace(/\\"/g,'"');r=r.replace(/%20/g," ");try{return JSON.parse(r)}catch(e){return null}}var a=t();if(a&&a.Extends&&a.Extends[0]){return a.Extends[0]}else{return null}}function m(t,r){var n=window.document.getElementById("sap-ui-theme-"+r);if(!n){return false}var s=window.getComputedStyle(n,":after");var h=s?s.getPropertyValue("content"):null;if(!h&&e.browser.safari){var o=document.documentElement;o.classList.add("sapUiThemeDesignerCustomCss");h=window.getComputedStyle(o,":after").getPropertyValue("content");o.classList.remove("sapUiThemeDesignerCustomCss")}if(h&&h!=="none"){try{if(h[0]==="'"||h[0]==='"'){h=h.substring(1,h.length-1)}return h==="true"}catch(e){a.error("Custom check: Error parsing JSON string for custom.css indication.",e)}}var l=n.sheet?i(n.sheet):null;if(!l||l.length===0){a.warning("Custom check: Failed retrieving a CSS rule from stylesheet "+r);return false}for(var u=0;u<2&&u<l.length;u++){if(t._CUSTOMCSSCHECK.test(l[u].selectorText)){return true}}return false}function c(e){this._iCount++;var t=this._iCount>n;if(!l(this)&&!t){var r;if(this._iCount<=100){r=2}else if(this._iCount<=110){r=500}else{r=1e3}this._sThemeCheckId=setTimeout(c.bind(this),r)}else if(!e){o(this);s.themeLoaded=true;this._oCore.fireThemeChanged({theme:this._oCore.getConfiguration().getTheme()});if(t){a.error("ThemeCheck: max. check cycles reached.")}}else{s.themeLoaded=true}}return s});
//# sourceMappingURL=ThemeCheck.js.map